<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Spelling Bee</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800;900&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #d4af37;
  --gold-dim: rgba(212,175,55,0.5);
  --gold-glow: rgba(212,175,55,0.15);
  --bg: #0c0a13;
  --card: rgba(30,26,46,0.97);
  --text: #f0ece2;
  --text-dim: rgba(255,255,255,0.55);
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body {
  height: 100%; overflow: hidden;
  background: var(--bg); color: var(--text);
  font-family: 'DM Sans', sans-serif;
  -webkit-user-select: none; user-select: none;
  -webkit-tap-highlight-color: transparent;
  -webkit-text-size-adjust: 100%;
}
body {
  display: flex; flex-direction: column;
  padding-top: var(--safe-top);
  padding-bottom: var(--safe-bottom);
  background: linear-gradient(170deg, #0c0a13 0%, #1a1528 45%, #110e1c 100%);
}

/* Header */
.header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px 16px 6px; flex-shrink: 0;
}
.header-left { display: flex; align-items: center; gap: 9px; }
.header-left span { font-size: 22px; }
.header-left h1 {
  font-family: 'Playfair Display', serif;
  font-size: 20px; font-weight: 700; letter-spacing: 0.02em;
}
.mode-btn {
  display: flex; align-items: center; gap: 6px;
  padding: 5px 13px; border-radius: 20px;
  border: 1.5px solid rgba(255,255,255,0.18);
  background: transparent; color: var(--text-dim);
  font-size: 12px; font-weight: 500; cursor: pointer;
  font-family: 'DM Sans', sans-serif; transition: all 0.25s;
}
.mode-btn.active {
  background: var(--gold-glow); border-color: var(--gold); color: var(--gold);
}
.mode-btn svg { width: 14px; height: 14px; }

/* Card */
.card-area {
  flex: 1; display: flex; flex-direction: column;
  padding: 6px 10px 0; overflow: hidden;
}
.card {
  flex: 1; display: flex; flex-direction: column;
  background: linear-gradient(150deg, rgba(38,32,56,0.97), rgba(22,18,36,0.99));
  border-radius: 22px;
  border: 1px solid rgba(212,175,55,0.1);
  padding: 16px 16px 14px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.04);
  overflow-y: auto; overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  transition: transform 0.08s ease;
}
.card::-webkit-scrollbar { display: none; }
.card-top {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 12px; flex-shrink: 0;
}
.counter { font-size: 11px; color: rgba(255,255,255,0.3); font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; }
.side-label { font-size: 9px; font-weight: 700; letter-spacing: 0.16em; color: var(--gold-dim); text-transform: uppercase; }
.card-top-right { display: flex; align-items: center; gap: 10px; }
.mark-btn {
  background: none; border: none; cursor: pointer; padding: 2px;
  color: rgba(255,255,255,0.25); transition: all 0.2s;
}
.mark-btn.active { color: var(--gold); }
.mark-btn svg { width: 22px; height: 22px; }

/* Sections */
.sect { display: flex; flex-direction: column; gap: 3px; margin-bottom: 11px; }
.tag {
  font-size: 9px; font-weight: 700; letter-spacing: 0.16em;
  color: var(--gold); text-transform: uppercase; opacity: 0.75; margin-bottom: 1px;
}
.pron-main {
  font-family: 'Playfair Display', serif;
  font-size: 21px; font-weight: 700; letter-spacing: 0.05em;
}
.ipa { font-size: 13px; color: rgba(255,255,255,0.38); font-family: monospace; }
.listen-btn {
  display: inline-flex; align-items: center; gap: 7px;
  padding: 5px 14px; border-radius: 20px;
  border: 1px solid rgba(212,175,55,0.3); background: rgba(212,175,55,0.08);
  color: var(--gold); cursor: pointer; font-family: 'DM Sans', sans-serif;
  font-size: 12.5px; font-weight: 500; margin-top: 5px; align-self: flex-start;
  transition: all 0.2s;
}
.listen-btn:active { background: rgba(212,175,55,0.2); }
.listen-btn svg { width: 15px; height: 15px; }
.pos-chip {
  display: inline-block; padding: 3px 12px; border-radius: 14px;
  background: rgba(212,175,55,0.1); border: 1px solid rgba(212,175,55,0.22);
  color: var(--gold); font-size: 13px; font-weight: 600; font-style: italic;
}
.def-text { font-size: 14px; line-height: 1.6; color: rgba(255,255,255,0.85); }
.origin-text { font-size: 13px; line-height: 1.55; color: var(--text-dim); font-style: italic; }
.ex-text {
  font-size: 13px; line-height: 1.6; color: rgba(255,255,255,0.65);
  border-left: 3px solid rgba(212,175,55,0.35); padding-left: 12px; font-style: italic;
}

/* Tap hint */
.tap-hint {
  text-align: center; padding: 12px 0 4px;
  font-size: 12px; color: rgba(255,255,255,0.2);
  letter-spacing: 0.04em; flex-shrink: 0;
}

/* Back */
.back-content { display: flex; flex-direction: column; align-items: center; gap: 20px; padding-top: 6px; flex: 1; }
.spelling-box {
  text-align: center; width: 100%; padding: 22px 12px 18px;
  background: linear-gradient(135deg, rgba(212,175,55,0.07), rgba(212,175,55,0.02));
  border-radius: 16px; border: 1px solid rgba(212,175,55,0.15);
}
.spelling-label {
  font-size: 10px; font-weight: 700; letter-spacing: 0.22em;
  color: rgba(212,175,55,0.6); text-transform: uppercase; margin-bottom: 10px;
}
.spelling-word {
  font-family: Verdana, Geneva, sans-serif; font-size: 36px; font-weight: 400;
  letter-spacing: 0.04em; line-height: 1.15;
  text-shadow: 0 2px 16px rgba(212,175,55,0.2); margin-bottom: 14px;
}
.letters-row { display: flex; justify-content: center; gap: 3px; flex-wrap: wrap; }
.letter-tile {
  display: inline-flex; align-items: center; justify-content: center;
  width: 27px; height: 34px; border-radius: 6px;
  background: rgba(212,175,55,0.08); border: 1px solid rgba(212,175,55,0.2);
  color: var(--gold); font-family: 'Playfair Display', serif;
  font-size: 17px; font-weight: 700;
  animation: letterPop 0.35s cubic-bezier(0.34,1.56,0.64,1) both;
}
.image-box {
  width: 100%; border-radius: 14px; overflow: hidden;
  border: 1px solid rgba(255,255,255,0.08); position: relative;
  animation: popIn 0.4s cubic-bezier(0.34,1.56,0.64,1) both;
  animation-delay: 0.15s;
}
.word-img { width: 100%; height: 190px; object-fit: cover; display: block; }
.img-caption {
  position: absolute; bottom: 0; left: 0; right: 0;
  padding: 20px 14px 8px;
  background: linear-gradient(transparent, rgba(0,0,0,0.7));
  font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.7);
  letter-spacing: 0.06em; text-transform: capitalize;
}
.loading-box { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 20px 0; }
.spinner {
  width: 22px; height: 22px;
  border: 2.5px solid rgba(212,175,55,0.2);
  border-top-color: var(--gold); border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
.loading-text { color: rgba(255,255,255,0.35); font-size: 12px; }

/* Bottom bar */
.bottom-bar {
  flex-shrink: 0;
  padding: 10px 16px 12px;
  display: flex; flex-direction: column; gap: 6px;
}
.nav-row {
  display: flex; align-items: center; justify-content: center; gap: 12px;
}
.nav-arrow {
  display: flex; align-items: center; justify-content: center;
  width: 36px; height: 36px; border-radius: 50%;
  border: 1.5px solid rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.04);
  color: rgba(255,255,255,0.5); cursor: pointer;
  transition: all 0.2s; flex-shrink: 0;
}
.nav-arrow:active { background: rgba(212,175,55,0.15); border-color: var(--gold); color: var(--gold); transform: scale(0.92); }
.nav-arrow svg { width: 18px; height: 18px; }
.slider-area {
  flex: 1; height: 32px; position: relative;
  display: flex; align-items: center;
  touch-action: none; cursor: pointer;
}
.slider-track-bg {
  width: 100%; height: 3px; border-radius: 2px;
  background: rgba(255,255,255,0.08); position: relative; overflow: hidden;
}
.slider-fill {
  height: 100%; border-radius: 2px;
  background: linear-gradient(90deg, var(--gold), rgba(212,175,55,0.5));
  transition: width 0.15s ease;
}
.slider-dots {
  position: absolute; top: 0; left: 0; right: 0; bottom: 0;
  display: flex; align-items: center; justify-content: space-between;
  pointer-events: none; padding: 0 2px;
}
.slider-tick {
  width: 2px; height: 8px; border-radius: 1px;
  background: rgba(255,255,255,0.06); flex-shrink: 0;
}
.slider-tick.major { height: 12px; background: rgba(255,255,255,0.12); }
.slider-tick.active { background: var(--gold); height: 14px; width: 3px; border-radius: 1.5px; box-shadow: 0 0 6px rgba(212,175,55,0.4); }
.slider-thumb {
  position: absolute; top: 50%; transform: translate(-50%, -50%);
  width: 20px; height: 20px; border-radius: 50%;
  background: var(--gold);
  border: 2.5px solid #1a1528;
  box-shadow: 0 0 10px rgba(212,175,55,0.5), 0 2px 6px rgba(0,0,0,0.4);
  cursor: grab; transition: left 0.12s ease;
  z-index: 2;
}
.slider-thumb:active { cursor: grabbing; transform: translate(-50%, -50%) scale(1.15); }
.slider-thumb.dragging { transition: none; transform: translate(-50%, -50%) scale(1.15); }
.slider-counter {
  text-align: center; font-size: 11px; font-weight: 600;
  color: rgba(255,255,255,0.25); letter-spacing: 0.08em;
}

/* Animations */
@keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
@keyframes popIn { 0% { transform: scale(0.92); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
@keyframes letterPop { 0% { transform: scale(0) rotate(-8deg); opacity: 0; } 60% { transform: scale(1.1) rotate(2deg); opacity: 1; } 100% { transform: scale(1) rotate(0); opacity: 1; } }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes slideOutL { from { transform: translateX(0); opacity: 1; } to { transform: translateX(-105%); opacity: 0; } }
@keyframes slideOutR { from { transform: translateX(0); opacity: 1; } to { transform: translateX(105%); opacity: 0; } }
.slide-out-l { animation: slideOutL 0.22s ease forwards; }
.slide-out-r { animation: slideOutR 0.22s ease forwards; }
.fade-in { animation: fadeUp 0.3s ease both; }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <span>üêù</span>
    <h1><a href="index.html" style="color:inherit;text-decoration:none;">Spelling Bee</a></h1>
  </div>
  <button class="mode-btn" id="modeBtn" onclick="toggleMarkedOnly()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
    <span id="modeBtnText">All (6)</span>
  </button>
</div>

<div class="card-area" id="cardArea">
  <div class="card" id="card"></div>
</div>

<div class="bottom-bar">
  <div class="nav-row">
    <button class="nav-arrow" id="prevBtn" onclick="navigateTo('right')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <div class="slider-area" id="sliderArea">
      <div class="slider-track-bg">
        <div class="slider-fill" id="sliderFill"></div>
      </div>
      <div class="slider-dots" id="sliderDots"></div>
      <div class="slider-thumb" id="sliderThumb"></div>
    </div>
    <button class="nav-arrow" id="nextBtn" onclick="navigateTo('left')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 6 15 12 9 18"/></svg>
    </button>
  </div>
  <div class="slider-counter" id="sliderCounter">1 / 208</div>
</div>

<script>
const WORDS = [
  { word:'labroid', pronunciation:'LAB-royd', ipa:'/Ààl√¶br…î…™d/', pos:'adjective', def:'Of or resembling the wrasse family of fishes; relating to the Labridae, a large family of brightly colored marine fish.', lang:'Greek, from labros (\'greedy, furious\') + -oid (\'resembling\'), referring to the feeding habits of wrasse fish.', example:'The labroid fish darted among the coral in flashes of electric blue and green, typical of the wrasse family\'s vivid coloring.', isNoun:false },
  { word:'labyrinthine', pronunciation:'LAB-uh-RINTH-een', ipa:'/Àål√¶b…ôÀàr…™nŒ∏iÀên/', pos:'adjective', def:'Of or resembling a labyrinth; irregular and twisting; complicated and confusing.', lang:'Greek, from labyrinthos (\'a maze\'), the legendary structure built by Daedalus for King Minos of Crete, + -ine.', example:'The labyrinthine streets of the old medina twisted and turned without logic, and tourists wandered lost for hours.', isNoun:false },
  { word:'laconic', pronunciation:'luh-KON-ik', ipa:'/l…ôÀàk…ín…™k/', pos:'adjective', def:'Using very few words; brief and concise to the point of seeming rude or mysterious.', lang:'Greek, from Lakonikos (\'of Laconia\'), the region of Sparta, whose inhabitants were famously terse in speech.', example:'When asked if he would surrender, the laconic general replied with a single word: \'No.\'', isNoun:false },
  { word:'lacustrine', pronunciation:'luh-KUS-trin', ipa:'/l…ôÀàk åstra…™n/', pos:'adjective', def:'Of, relating to, or associated with lakes; living or growing in or beside a lake.', lang:'Latin, from lacustris (\'of a lake\'), from lacus (\'a lake\'), + -ine.', example:'The lacustrine sediments at the bottom of the ancient lake bed contained fossils dating back millions of years.', isNoun:false },
  { word:'ladang', pronunciation:'luh-DAHNG', ipa:'/l…ôÀàd…ëÀê≈ã/', pos:'noun', def:'A system of shifting agriculture in Southeast Asia in which forest is cleared, farmed briefly, then left to regenerate.', lang:'Malay, from ladang (\'a dry rice field, clearing\'), a traditional farming method across the Malay Archipelago.', example:'The villagers practiced ladang, clearing a patch of jungle to grow rice for two seasons before moving to fresh ground.', isNoun:true },
  { word:'laity', pronunciation:'LAY-ih-tee', ipa:'/Ààle…™…™ti/', pos:'noun', def:'Lay people, as distinct from the clergy; people who are not members of a particular profession.', lang:'Old French, from lai (\'lay, secular\'), from Latin laicus, from Greek laikos (\'of the people\'), from laos (\'the people\'), + -ity.', example:'The bishop encouraged greater participation from the laity, believing the church thrived when ordinary members took active roles.', isNoun:true },
  { word:'lambently', pronunciation:'LAM-bunt-lee', ipa:'/Ààl√¶mb…ôntli/', pos:'adverb', def:'In a softly bright or radiant manner; glowing gently without burning; with a light, brilliant quality.', lang:'Latin, from lambens, present participle of lambere (\'to lick\'), suggesting light that seems to lick a surface, + -ly.', example:'The candles glowed lambently across the dinner table, their soft light casting warm shadows on every smiling face.', isNoun:false },
  { word:'lambkin', pronunciation:'LAM-kin', ipa:'/Ààl√¶mk…™n/', pos:'noun', def:'A small or young lamb; used as a term of endearment for a gentle or innocent person.', lang:'English, from lamb (from Old English, of Germanic origin) + -kin (diminutive suffix meaning \'little\').', example:'The tiny lambkin wobbled on unsteady legs across the meadow, bleating softly as it searched for its mother.', isNoun:true },
  { word:'Lancasterian', pronunciation:'lan-KAS-TEER-ee-un', ipa:'/Àål√¶≈ãk√¶sÀàt…™…ôri…ôn/', pos:'adjective', def:'Of or relating to the educational system devised by Joseph Lancaster, using older students as monitors to teach younger ones.', lang:'Named after Joseph Lancaster (1778-1838), the English educator who developed the monitorial system of instruction, + -ian.', example:'The Lancasterian method allowed a single teacher to educate hundreds of students by training the brightest as monitors for their peers.', isNoun:false },
  { word:'languorous', pronunciation:'LANG-gur-us', ipa:'/Ààl√¶≈ã…°…ôr…ôs/', pos:'adjective', def:'Characterized by tiredness or inactivity; relaxed and dreamy; lacking energy or vitality.', lang:'Latin, from languor (\'faintness, weariness\'), from languere (\'to be faint, weary\'), + -ous.', example:'The languorous summer afternoon invited nothing more ambitious than dozing in a hammock beneath the shade of the old oak tree.', isNoun:false },
  { word:'lanolated', pronunciation:'LAN-uh-LAY-tid', ipa:'/Ààl√¶n…ôÀåle…™t…™d/', pos:'adjective', def:'Containing or treated with lanolin; coated or mixed with the waxy substance derived from sheep\'s wool.', lang:'Latin, from lana (\'wool\') + oleum (\'oil\'), + -ated, describing something infused with wool fat.', example:'The lanolated hand cream left her skin feeling soft and moisturized, the natural wool oil forming a protective barrier.', isNoun:false },
  { word:'lantana', pronunciation:'lan-TAN-uh', ipa:'/l√¶nÀàt√¶n…ô/', pos:'noun', def:'A tropical shrub of the verbena family with clusters of brightly colored flowers, often considered invasive in warm regions.', lang:'Italian, from lantana, possibly related to Latin lentare (\'to bend\'), or from the resemblance to the viburnum plant.', example:'The lantana bushes exploded with tiny clusters of orange, pink, and yellow flowers that attracted butterflies from across the garden.', isNoun:true },
  { word:'larceny', pronunciation:'LAR-suh-nee', ipa:'/Ààl…ëÀêrs…ôni/', pos:'noun', def:'Theft of personal property; the unlawful taking of someone else\'s belongings.', lang:'Old French, from larcin (\'theft\'), from Latin latrocinium (\'robbery, piracy\'), from latro (\'a robber, mercenary soldier\').', example:'The shoplifter was charged with petty larceny after being caught on camera stuffing merchandise into her coat pockets.', isNoun:true },
  { word:'largesses', pronunciation:'lar-JES-iz', ipa:'/l…ëÀêrÀàd í…õs…™z/', pos:'noun', def:'Generous bestowals of gifts or money; acts of liberal giving; bounty or munificence.', lang:'Old French, from largesse (\'generosity, bounty\'), from Latin largus (\'abundant, generous\'), + -es.', example:'The patron\'s largesses funded new wings for the hospital, scholarships for students, and restoration of the historic theater.', isNoun:true },
  { word:'larnax', pronunciation:'LAR-naks', ipa:'/Ààl…ëÀêrn√¶ks/', pos:'noun', def:'A small chest or coffin used in ancient Greece and Crete for burial or storing remains; a clay or stone casket.', lang:'Greek, from larnax (\'a chest, coffer, coffin\'), used for both storage and burial in Minoan and Mycenaean cultures.', example:'The archaeologist carefully opened the painted larnax, revealing the cremated remains of a Minoan noble buried over three thousand years ago.', isNoun:true },
  { word:'lassitude', pronunciation:'LAS-ih-tood', ipa:'/Ààl√¶s…™ÀåtjuÀêd/', pos:'noun', def:'A state of physical or mental weariness; a lack of energy or enthusiasm; listlessness.', lang:'Latin, from lassitudo (\'weariness\'), from lassus (\'faint, weary\').', example:'A deep lassitude settled over her after the marathon, and she could barely summon the energy to lift her water bottle.', isNoun:true },
  { word:'latifondo', pronunciation:'LAT-ih-FON-doh', ipa:'/Àål√¶t…™Ààf…índo ä/', pos:'noun', def:'A large landed estate or ranch, especially in Latin America or southern Europe, typically with absentee ownership.', lang:'Italian and Spanish, from Latin latifundium (\'a large estate\'), from latus (\'broad, wide\') + fundus (\'a farm, estate\').', example:'The vast latifondo stretched for miles across the valley, its thousands of acres worked by generations of tenant farmers.', isNoun:true },
  { word:'latigo', pronunciation:'LAT-ih-goh', ipa:'/Ààl√¶t…™Àå…°o ä/', pos:'noun', def:'A strap on a Western saddle used to tighten and secure the cinch; a leather fastening strap.', lang:'Spanish, from l√°tigo (\'a whip, lash\'), from Latin *lactigum, possibly related to the use of leather straps.', example:'The cowboy pulled the latigo tight to secure the saddle before swinging up onto the horse for the long ride across the range.', isNoun:true },
  { word:'laudatory', pronunciation:'LAW-duh-TOR-ee', ipa:'/Ààl…îÀêd…ôÀåt…îÀêri/', pos:'adjective', def:'Expressing praise and commendation; highly complimentary.', lang:'Latin, from laudatorius (\'praising\'), from laudare (\'to praise\'), from laus (genitive laudis, \'praise\').', example:'The laudatory review praised every aspect of the restaurant, from the inventive menu to the impeccable service.', isNoun:false },
  { word:'lavender', pronunciation:'LAV-un-dur', ipa:'/Ààl√¶v…ônd…ôr/', pos:'noun', def:'An aromatic shrub with narrow leaves and bluish-purple flowers, widely used in perfumery, cooking, and herbal medicine.', lang:'Anglo-French, from lavandre, from Medieval Latin lavendula, possibly from Latin lavare (\'to wash\'), as lavender was used to scent bathwater.', example:'The rows of lavender swayed in the Proven√ßal breeze, their purple blossoms filling the warm summer air with sweet, calming fragrance.', isNoun:true },
  { word:'leery', pronunciation:'LEER-ee', ipa:'/Ààl…™…ôri/', pos:'adjective', def:'Cautious or wary due to realistic suspicions; mistrustful and guarded.', lang:'English, from leer (\'to look slyly or suspiciously\', from Old English hleor, \'cheek, face\') + -y.', example:'She was leery of the deal that seemed too good to be true, and her caution proved justified when the fine print revealed hidden fees.', isNoun:false },
  { word:'legalese', pronunciation:'LEE-gul-EEZ', ipa:'/ÀåliÀê…°…ôÀàliÀêz/', pos:'noun', def:'The formal and technical language of legal documents, often difficult for ordinary people to understand.', lang:'English, from legal (from Latin legalis, \'of the law\') + -ese (\'language of\'), modeled on words like Chinese or Japanese.', example:'The contract was written in such dense legalese that even the business owner needed a lawyer to explain what she was signing.', isNoun:true },
  { word:'legato', pronunciation:'luh-GAH-toh', ipa:'/l…ôÀà…°…ëÀêto ä/', pos:'adverb', def:'In a smooth, flowing manner without breaks between notes; a musical direction for connected, sustained playing.', lang:'Italian, from legato (\'bound, tied\'), past participle of legare (\'to tie\'), from Latin ligare (\'to bind\').', example:'The cellist played the passage legato, each note flowing seamlessly into the next like a long, unbroken ribbon of sound.', isNoun:false },
  { word:'legerity', pronunciation:'leh-JER-ih-tee', ipa:'/l…ôÀàd í…õr…™ti/', pos:'noun', def:'Physical or mental agility; lightness and nimbleness of movement or thought.', lang:'French, from l√©g√®ret√© (\'lightness\'), from l√©ger (\'light\'), from Latin levis (\'light in weight\').', example:'The acrobat\'s legerity was breathtaking as she flipped and twisted through the air, landing each move with catlike precision.', isNoun:true },
  { word:'lemniscus', pronunciation:'lem-NIS-kus', ipa:'/l…õmÀàn…™sk…ôs/', pos:'noun', def:'A ribbon-like bundle of nerve fibers in the brain; in anatomy, a band of sensory pathways in the central nervous system.', lang:'Latin, from lemniscus (\'a ribbon\'), from Greek lemniskos (\'a woolen ribbon\').', example:'The medial lemniscus carries sensory information about touch and proprioception from the body up to the brain\'s thalamus.', isNoun:true },
  { word:'lerot', pronunciation:'leh-ROH', ipa:'/l…ôÀàro ä/', pos:'noun', def:'The garden dormouse, a small nocturnal rodent with a distinctive black face mask, native to Europe.', lang:'French, from l√©rot (\'garden dormouse\'), a diminutive form, of uncertain further origin.', example:'The tiny lerot peered out from behind the barn rafters, its black eye mask giving it the look of a miniature bandit.', isNoun:true },
  { word:'leviathan', pronunciation:'lih-VY-uh-thun', ipa:'/l…™Ààva…™…ôŒ∏…ôn/', pos:'noun', def:'A sea monster mentioned in the Bible; something enormous and powerful, especially a ship or organization.', lang:'Hebrew, from livyathan (\'a great sea creature\'), of uncertain origin, described in the Book of Job as untamable.', example:'The cargo ship was a leviathan of the seas, stretching over a thousand feet long and carrying enough containers to fill a small city.', isNoun:true },
  { word:'liaise', pronunciation:'lee-AYZ', ipa:'/liÀàe…™z/', pos:'verb', def:'To establish a working connection or cooperative relationship; to communicate and work together effectively.', lang:'French, back-formation from liaison (\'a connection, link\'), from lier (\'to bind\'), from Latin ligare (\'to bind\').', example:'The project manager was hired to liaise between the design team and the client, ensuring both sides stayed aligned.', isNoun:false },
  { word:'lidocaine', pronunciation:'LY-doh-kayn', ipa:'/Ààla…™do äÀåke…™n/', pos:'noun', def:'A synthetic compound used as a local anesthetic and to treat abnormal heart rhythms.', lang:'English, from (acety)lid(e) + -o- + -caine (from cocaine, the original local anesthetic), describing its chemical structure.', example:'The dentist injected lidocaine into the gum to numb the area completely before beginning the filling procedure.', isNoun:true },
  { word:'limned', pronunciation:'LIMD', ipa:'/l…™md/', pos:'verb', def:'Depicted or described in painting or words; drawn or painted, especially in a detailed or vivid way.', lang:'Old French, from enluminer (\'to illuminate a manuscript\'), from Latin illuminare (\'to light up, adorn\').', example:'The artist limned the portrait with such exquisite detail that viewers swore the subject\'s eyes followed them around the room.', isNoun:false },
  { word:'limpa', pronunciation:'LIM-puh', ipa:'/Ààl…™mp…ô/', pos:'noun', def:'A Swedish rye bread flavored with molasses, orange peel, and spices such as anise and fennel.', lang:'Swedish, from limpa (\'a loaf of bread\'), of uncertain further origin.', example:'The fragrant limpa bread, dark with molasses and scented with orange zest, was the centerpiece of the Scandinavian holiday table.', isNoun:true },
  { word:'limpet', pronunciation:'LIM-pit', ipa:'/Ààl…™mp…™t/', pos:'noun', def:'A marine mollusk with a shallow conical shell that clings tightly to rocks; someone who clings tenaciously.', lang:'Old English, from lempedu (\'a limpet\'), from Medieval Latin lampreda, related to lamprey.', example:'The limpet clung to the wave-battered rock with such tenacity that even the strongest surge could not dislodge it.', isNoun:true },
  { word:'limpid', pronunciation:'LIM-pid', ipa:'/Ààl…™mp…™d/', pos:'adjective', def:'Of a liquid, free of anything that darkens; completely clear and transparent; easy to understand.', lang:'Latin, from limpidus (\'clear, transparent\'), possibly related to lympha (\'water, clear fluid\').', example:'The limpid mountain pool was so crystal clear that every pebble on the bottom was visible from twenty feet above.', isNoun:false },
  { word:'limpkin', pronunciation:'LIMP-kin', ipa:'/Ààl…™mpk…™n/', pos:'noun', def:'A large wading bird of the Americas with brown plumage and a distinctive wailing cry, feeding mainly on apple snails.', lang:'English, from limp + -kin (diminutive suffix), because of its halting, uneven gait when walking.', example:'The limpkin\'s eerie, wailing cry echoed across the Florida swamp as it probed the shallows for its favorite apple snails.', isNoun:true },
  { word:'lingua franca', pronunciation:'LING-gwuh FRANG-kuh', ipa:'/Àål…™≈ã…°w…ô Ààfr√¶≈ãk…ô/', pos:'noun', def:'A language used as a common means of communication between peoples of different native languages.', lang:'Italian, literally \'Frankish tongue\', originally a mixed language used in Mediterranean ports for trade between Europeans and Arabs.', example:'English has become the lingua franca of international business, spoken in boardrooms and airports around the globe.', isNoun:true },
  { word:'linnet', pronunciation:'LIN-it', ipa:'/Ààl…™n…™t/', pos:'noun', def:'A small brown and gray finch with a melodious song, found across Europe, named for its fondness for flax seeds.', lang:'Old French, from linette (\'a linnet\'), from lin (\'flax\'), from Latin linum, because the bird feeds on flaxseeds.', example:'The linnet sang from the hedgerow with a sweet, warbling melody that brightened the quiet country lane.', isNoun:true },
  { word:'linstock', pronunciation:'LIN-stok', ipa:'/Ààl…™nÀåst…ík/', pos:'noun', def:'A staff with a forked tip used to hold a lighted match for firing a cannon in historical warfare.', lang:'Dutch, from lontstock, from lont (\'a match, slow fuse\') + stock (\'a stick\'), literally \'match stick\'.', example:'The artilleryman held the smoldering linstock steady, touching its glowing match to the cannon\'s touchhole to fire the shot.', isNoun:true },
  { word:'literatim', pronunciation:'LIT-ur-AY-tim', ipa:'/Àål…™t…ôÀàre…™t…™m/', pos:'adverb', def:'Letter for letter; literally and exactly as written, without any alteration.', lang:'Latin, from literatim (\'letter by letter\'), from littera (\'a letter of the alphabet\').', example:'The scribe was instructed to copy the ancient text literatim, reproducing every letter exactly as it appeared in the original.', isNoun:false },
  { word:'lithium', pronunciation:'LITH-ee-um', ipa:'/Ààl…™Œ∏i…ôm/', pos:'noun', def:'A soft, silver-white metallic element, the lightest of all metals, used in batteries and psychiatric medication.', lang:'Greek, from lithos (\'stone\'), + -ium, because it was first discovered in a mineral rather than in plant material like sodium and potassium.', example:'Lithium batteries power everything from smartphones to electric vehicles, making the element one of the most sought-after resources today.', isNoun:true },
  { word:'lithophone', pronunciation:'LITH-oh-fohn', ipa:'/Ààl…™Œ∏…ôÀåfo än/', pos:'noun', def:'A musical instrument made of stones or stone slabs that produce tones when struck; a stone xylophone.', lang:'Greek, from lithos (\'stone\') + phone (\'sound, voice\').', example:'The ancient lithophone, carved from flat stone slabs of different thicknesses, produced surprisingly melodic tones when struck with a mallet.', isNoun:true },
  { word:'litmus', pronunciation:'LIT-mus', ipa:'/Ààl…™tm…ôs/', pos:'noun', def:'A dye obtained from lichens that turns red in acid and blue in alkaline solutions, used as an indicator; a decisive test.', lang:'Old Norse, from litmosi, from lit (\'dye, color\') + mosi (\'moss\'), because the dye comes from lichen.', example:'The chemistry teacher dipped litmus paper into the solution, and it turned bright red, confirming the liquid was acidic.', isNoun:true },
  { word:'lobectomy', pronunciation:'loh-BEK-tuh-mee', ipa:'/lo äÀàb…õkt…ômi/', pos:'noun', def:'A surgical operation to remove a lobe of an organ, most commonly a lobe of the lung.', lang:'Greek, from lobos (\'a lobe\') + ektome (\'a cutting out\'), from ek (\'out\') + temnein (\'to cut\').', example:'The surgeon performed a lobectomy to remove the diseased section of the patient\'s lung, successfully excising the tumor.', isNoun:true },
  { word:'lobotomy', pronunciation:'loh-BOT-uh-mee', ipa:'/lo äÀàb…ít…ômi/', pos:'noun', def:'A surgical operation involving incision into the prefrontal lobe of the brain, formerly used to treat mental illness; now discredited.', lang:'Greek, from lobos (\'a lobe\') + -tomia (\'a cutting\'), from temnein (\'to cut\').', example:'The lobotomy was once considered a miracle cure for mental illness, but it was abandoned as its devastating side effects became clear.', isNoun:true },
  { word:'locavore', pronunciation:'LOH-kuh-vor', ipa:'/Ààlo äk…ôÀåv…îÀêr/', pos:'noun', def:'A person whose diet consists mainly of locally grown or produced food.', lang:'English, from local (from Latin localis, \'of a place\') + -vore (from Latin vorare, \'to devour\'), coined in 2005 in San Francisco.', example:'The dedicated locavore shopped exclusively at the farmers\' market, insisting that every ingredient come from within fifty miles.', isNoun:true },
  { word:'loch', pronunciation:'LOKH', ipa:'/l…íx/', pos:'noun', def:'A Scottish word for a lake or a narrow inlet of the sea; a body of water enclosed by land.', lang:'Scottish Gaelic, from loch (\'a lake, fjord\'), from Old Irish loch, of Celtic origin.', example:'The still waters of the Highland loch reflected the surrounding mountains like a perfect mirror on the windless morning.', isNoun:true },
  { word:'logographic', pronunciation:'LOG-oh-GRAF-ik', ipa:'/Àål…í…°…ôÀà…°r√¶f…™k/', pos:'adjective', def:'Of or relating to a writing system using symbols that represent whole words or concepts rather than individual sounds.', lang:'Greek, from logos (\'word\') + graphikos (\'of writing\'), from graphein (\'to write\'), + -ic.', example:'Chinese is a logographic writing system, with each character representing a word or concept rather than a single sound.', isNoun:false },
  { word:'longitude', pronunciation:'LON-jih-tood', ipa:'/Ààl…índ í…™ÀåtjuÀêd/', pos:'noun', def:'The angular distance of a place east or west of the prime meridian at Greenwich, measured in degrees.', lang:'Latin, from longitudo (\'length\'), from longus (\'long\'), because lines of longitude run the length of the globe from pole to pole.', example:'The navigator checked the ship\'s longitude against the charts to confirm they were still on course across the open Atlantic.', isNoun:true },
  { word:'lorikeet', pronunciation:'LOR-ih-keet', ipa:'/Ààl…ír…™ÀåkiÀêt/', pos:'noun', def:'A small, brightly colored parrot with a brush-tipped tongue adapted for feeding on nectar and pollen, native to Australasia.', lang:'English, diminutive of lory (\'a type of parrot\'), from Malay luri or nuri (\'a parrot\'), + -keet.', example:'The rainbow lorikeet landed on her outstretched hand, its plumage a dazzling mosaic of green, blue, orange, and yellow.', isNoun:true },
  { word:'lossy', pronunciation:'LOSS-ee', ipa:'/Ààl…ísi/', pos:'adjective', def:'Of data compression, having some loss of data and therefore of quality; not perfectly preserving the original information.', lang:'English, from loss (from Old English los, \'destruction\') + -y, a computing term contrasting with lossless.', example:'The image was saved in a lossy format to reduce the file size, but some fine details were noticeably blurred as a result.', isNoun:false },
  { word:'lousicide', pronunciation:'LOW-sih-syd', ipa:'/Ààla äs…™Àåsa…™d/', pos:'noun', def:'A substance or preparation used to kill lice; a pediculicide.', lang:'English, from louse (from Old English lus, of Germanic origin) + -cide (from Latin -cida, \'a killer\'), from caedere (\'to kill\').', example:'The school nurse recommended a medicated lousicide shampoo to treat the outbreak of head lice among the younger students.', isNoun:true },
  { word:'loutrophoros', pronunciation:'LOO-troh-FOR-os', ipa:'/ÀåluÀêtro äÀàf…îÀêr…ís/', pos:'noun', def:'A type of ancient Greek vase with two handles and a long neck, used to carry water for the bridal bath or for funerary rituals.', lang:'Greek, from loutron (\'a bath\') + phoros (\'bearing, carrying\'), from pherein (\'to carry\').', example:'The museum displayed a beautifully painted loutrophoros used in ancient Athenian wedding ceremonies to carry bathwater for the bride.', isNoun:true },
  { word:'lovage', pronunciation:'LUV-ij', ipa:'/Ààl åv…™d í/', pos:'noun', def:'A tall herbaceous plant of the parsley family, with large leaves used as a herb and celery-flavored stems.', lang:'Old French, from luvesche, from Latin levisticum, alteration of ligusticum (\'of Liguria\'), the Italian region where it was commonly grown.', example:'The cook added a handful of fresh lovage leaves to the soup, their intense celery-like flavor enriching the broth beautifully.', isNoun:true },
  { word:'luculent', pronunciation:'LOO-kyoo-lunt', ipa:'/ÀàluÀêkj äl…ônt/', pos:'adjective', def:'Clearly expressed; easily understood; bright and luminous.', lang:'Latin, from luculentus (\'full of light, brilliant, splendid\'), from lux (genitive lucis, \'light\').', example:'The professor\'s luculent explanation of quantum mechanics made even the most complex concepts accessible to first-year students.', isNoun:false },
  { word:'ludicrous', pronunciation:'LOO-dih-krus', ipa:'/ÀàluÀêd…™kr…ôs/', pos:'adjective', def:'So foolish, unreasonable, or out of place as to be amusing; ridiculous and absurd.', lang:'Latin, from ludicrus (\'sportive\'), from ludus (\'a game, play, sport\').', example:'The idea of holding an outdoor wedding during a hurricane was so ludicrous that everyone assumed she was joking.', isNoun:false },
  { word:'lumen', pronunciation:'LOO-men', ipa:'/ÀàluÀêm…ôn/', pos:'noun', def:'The SI unit of luminous flux; the interior space of a tubular organ such as a blood vessel or intestine.', lang:'Latin, from lumen (\'light, an opening\'), related to lucere (\'to shine\').', example:'The standard light bulb produces about 800 lumens, enough to comfortably illuminate an average-sized room.', isNoun:true },
  { word:'luthier', pronunciation:'LOO-tee-ay', ipa:'/ÀàluÀêti…ôr/', pos:'noun', def:'A maker of stringed instruments such as violins, guitars, and lutes.', lang:'French, from luthier, from luth (\'a lute\'), from Arabic al- ø≈´d (\'the wood, the lute\').', example:'The master luthier shaped the violin\'s spruce top by hand, carefully carving each curve to produce the richest possible tone.', isNoun:true },
  { word:'lutrine', pronunciation:'LOO-trin', ipa:'/ÀàluÀêtra…™n/', pos:'adjective', def:'Of, relating to, or resembling an otter; belonging to the otter subfamily.', lang:'Latin, from lutra (\'an otter\'), + -ine.', example:'The lutrine creature slid gracefully down the muddy riverbank and plunged into the water, its sleek body barely making a splash.', isNoun:false },
  { word:'luxuriate', pronunciation:'lug-ZHOOR-ee-ayt', ipa:'/l å…°Àà í ä…ôriÀåe…™t/', pos:'verb', def:'To enjoy oneself in a luxurious way; to relax and take great pleasure in something; to grow profusely.', lang:'Latin, from luxuriatus, past participle of luxuriari (\'to be excessive, grow rankly\'), from luxuria (\'excess, luxury\').', example:'After months of hard work, she allowed herself to luxuriate in a long, hot bubble bath with a glass of champagne.', isNoun:false }
];

let currentIndex = 0, flipped = false, markedWords = new Set(), markedOnly = false;
let imageCache = {}, imageLoading = {};
let touchStartX = 0, swipeX = 0;

function aw() { return markedOnly ? WORDS.filter((_,i) => markedWords.has(i)) : WORDS; }
function si() { const a=aw(); if(markedOnly){const i=a.findIndex(w=>w.word===WORDS[currentIndex]?.word);return i>=0?i:0;} return currentIndex; }
function gi() { const a=aw(),s=si(); return WORDS.findIndex(w=>w.word===a[s]?.word); }

function speak(t) { speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance(t); u.rate=0.85;u.pitch=1;u.lang="en-US"; speechSynthesis.speak(u); }

async function fetchImage(word) {
  if(imageCache[word]||imageLoading[word]) return;
  imageLoading[word]=true;
  // Update just the image placeholder if it exists
  const imgPlaceholder = document.getElementById('img-'+word);
  if(imgPlaceholder) imgPlaceholder.innerHTML=`<div class="loading-box"><div class="spinner"></div><span class="loading-text">Finding image‚Ä¶</span></div>`;
  try {
    const r=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1000,messages:[{role:"user",content:'Search online and find a direct image URL for "'+word+'". Return ONLY the raw URL ending in .jpg/.jpeg/.png/.svg/.webp. No markdown, no explanation.'}],tools:[{type:"web_search_20250305",name:"web_search"}]})});
    const d=await r.json(); const t=d.content.map(b=>b.type==="text"?b.text:"").filter(Boolean).join("\n").trim();
    const m=t.match(/https?:\/\/[^\s"'<>\)]+\.(jpg|jpeg|png|svg|webp)([^\s"'<>\)]*)*/i);
    imageCache[word]=m?m[0]:null;
  } catch(e){imageCache[word]=null;}
  imageLoading[word]=false;
  // Update just the image placeholder if still on same word
  const imgEl = document.getElementById('img-'+word);
  if(imgEl && imageCache[word]) {
    imgEl.innerHTML=`<div class="image-box"><img class="word-img" src="${imageCache[word]}" alt="${word}" onerror="this.parentElement.style.display='none'"><div class="img-caption">${word}</div></div>`;
  } else if(imgEl) {
    imgEl.innerHTML='';
  }
}

const starSvg=f=>`<svg viewBox="0 0 24 24" fill="${f?'currentColor':'none'}" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`;
const speakerSvg=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>`;

function renderFront(w) {
  return `
    <div class="sect fade-in"><div class="tag">PRONUNCIATION</div><div class="pron-main">${w.pronunciation}</div><div class="ipa">${w.ipa}</div>
      <button class="listen-btn" onclick="event.stopPropagation();speak('${w.word}')">${speakerSvg}<span>Listen</span></button></div>
    <div class="sect fade-in" style="animation-delay:.06s"><div class="tag">PART OF SPEECH</div><span class="pos-chip">${w.pos}</span></div>
    <div class="sect fade-in" style="animation-delay:.12s"><div class="tag">DEFINITION</div><div class="def-text">${w.def}</div></div>
    <div class="sect fade-in" style="animation-delay:.18s"><div class="tag">LANGUAGE OF ORIGIN</div><div class="origin-text">${w.lang}</div></div>
    <div class="sect fade-in" style="animation-delay:.24s"><div class="tag">EXAMPLE</div><div class="ex-text">"${w.example.replace(new RegExp(w.word,'gi'),'________')}"</div></div>
    <div class="tap-hint fade-in" style="animation-delay:.3s">Tap card to reveal spelling</div>`;
}

function renderBack(w) {
  const letters=w.word.split("").map((c,i)=>`<span class="letter-tile" style="animation-delay:${i*0.04+0.12}s">${c}</span>`).join("");
  let img="";
  if(w.isNoun){
    let imgContent = "";
    if(imageLoading[w.word]) imgContent=`<div class="loading-box"><div class="spinner"></div><span class="loading-text">Finding image‚Ä¶</span></div>`;
    else if(imageCache[w.word]) imgContent=`<div class="image-box"><img class="word-img" src="${imageCache[w.word]}" alt="${w.word}" onerror="this.parentElement.style.display='none'"><div class="img-caption">${w.word}</div></div>`;
    img=`<div id="img-${w.word}">${imgContent}</div>`;
  }
  return `<div class="back-content">
    <div class="spelling-box" style="animation:popIn .4s cubic-bezier(.34,1.56,.64,1) both">
      <div class="spelling-label">THE WORD IS</div><h2 class="spelling-word">${w.word}</h2>
      <div class="letters-row">${letters}</div>
      <button class="listen-btn" style="margin:14px auto 0" onclick="event.stopPropagation();speak('${w.word}')">${speakerSvg}<span>Hear Again</span></button>
    </div>${img}
    <div class="tap-hint">Tap card to go back to clues</div></div>`;
}

function render() {
  const a=aw();
  if(!a.length){ document.getElementById("card").innerHTML=`<div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px"><p style="color:rgba(255,255,255,0.5);font-size:16px">No marked words yet.</p><button class="flip-btn" style="width:auto;padding:10px 24px" onclick="markedOnly=false;render()">‚Üê Show All</button></div>`; return; }
  const s=si(), g=gi(), w=a[s];

  document.getElementById("card").innerHTML=`<div class="card-top"><span class="counter">${s+1} / ${a.length}</span><div class="card-top-right"><span class="side-label">${flipped?'ANSWER':'CLUES'}</span><button class="mark-btn ${markedWords.has(g)?'active':''}" onclick="toggleMark(${g})">${starSvg(markedWords.has(g))}</button></div></div>`+(flipped?renderBack(w):renderFront(w));

  if(flipped && w.isNoun&&!imageCache[w.word]&&!imageLoading[w.word]) fetchImage(w.word);

  // Slider
  const totalA = a.length;
  const pct = totalA > 1 ? s / (totalA - 1) * 100 : 0;
  document.getElementById("sliderFill").style.width = pct + "%";
  const sliderArea = document.getElementById("sliderArea");
  const areaW = sliderArea.offsetWidth || 200;
  const pad = 10;
  const thumbLeft = pad + (pct / 100) * (areaW - pad * 2);
  const thumb = document.getElementById("sliderThumb");
  if(!thumb.classList.contains('dragging')) thumb.style.left = thumbLeft + "px";

  // Ticks - show ~20 evenly spaced markers
  const tickCount = Math.min(totalA, 20);
  let ticksHtml = '';
  for(let t=0; t<tickCount; t++){
    const ti = Math.round(t / (tickCount-1) * (totalA-1));
    const cls = ti===s ? 'active' : (t % 5 === 0 ? 'major' : '');
    ticksHtml += `<div class="slider-tick ${cls}"></div>`;
  }
  document.getElementById("sliderDots").innerHTML = ticksHtml;
  document.getElementById("sliderCounter").textContent = `${s+1} / ${totalA}`;

  // Mode btn
  const mb=document.getElementById("modeBtn");
  mb.className="mode-btn"+(markedOnly?" active":"");
  mb.querySelector("svg").setAttribute("fill",markedOnly?"currentColor":"none");
  document.getElementById("modeBtnText").textContent=(markedOnly?"Marked":"All")+` (${markedOnly?markedWords.size:WORDS.length})`;
}

function jumpTo(idx) {
  const a=aw(); if(idx<0||idx>=a.length) return;
  const g=WORDS.findIndex(w=>w.word===a[idx].word);
  flipped=false; currentIndex=g; render();
  setTimeout(()=>speak(a[idx].word),200);
}

function navigateTo(dir) {
  const a=aw(); if(!a.length) return;
  const s=si(), card=document.getElementById("card");
  card.classList.add(dir==="left"?"slide-out-l":"slide-out-r");
  flipped=false;
  setTimeout(()=>{
    card.classList.remove("slide-out-l","slide-out-r");
    const ni=dir==="left"?(s+1)%a.length:(s-1+a.length)%a.length;
    currentIndex=WORDS.findIndex(w=>w.word===a[ni].word);
    render(); setTimeout(()=>speak(a[ni].word),150);
  },220);
}

function flipCard(){flipped=!flipped;render();}
function toggleMark(g){markedWords.has(g)?markedWords.delete(g):markedWords.add(g);render();}
function toggleMarkedOnly(){if(!markedOnly&&markedWords.size===0)return;markedOnly=!markedOnly;flipped=false;render();}

// Swipe
const ca=document.getElementById("cardArea");
let swiped=false;
ca.addEventListener("touchstart",e=>{touchStartX=e.touches[0].clientX;swiped=false;},{passive:true});
ca.addEventListener("touchmove",e=>{swipeX=e.touches[0].clientX-touchStartX;if(Math.abs(swipeX)>15)swiped=true;},{passive:true});
ca.addEventListener("touchend",()=>{if(Math.abs(swipeX)>50)navigateTo(swipeX<0?"left":"right");swipeX=0;});

// Card tap to flip
const card=document.getElementById("card");
card.addEventListener("click",e=>{
  if(e.target.closest('button')||swiped) return;
  flipCard();
});

// Slider drag
const slArea=document.getElementById("sliderArea");
const slThumb=document.getElementById("sliderThumb");
let slDragging=false;
function sliderFromX(cx){
  const r=slArea.getBoundingClientRect();
  const pad=10;
  const p=Math.max(0,Math.min(1,(cx-r.left-pad)/(r.width-pad*2)));
  const a=aw(),idx=Math.round(p*(a.length-1));
  // Move thumb immediately for smooth feel
  const thumbLeft=pad+(p)*(r.width-pad*2);
  slThumb.style.left=thumbLeft+"px";
  if(idx!==si()){
    const g=WORDS.findIndex(w=>w.word===a[idx].word);
    flipped=false; currentIndex=g; render();
  }
}
slArea.addEventListener("touchstart",e=>{
  slDragging=true; slThumb.classList.add('dragging');
  sliderFromX(e.touches[0].clientX);
},{passive:true});
document.addEventListener("touchmove",e=>{
  if(slDragging) sliderFromX(e.touches[0].clientX);
},{passive:true});
document.addEventListener("touchend",()=>{
  if(slDragging){
    slDragging=false; slThumb.classList.remove('dragging');
    // Speak the word after releasing
    const a=aw(),s=si();
    if(a[s]) setTimeout(()=>speak(a[s].word),100);
  }
});
slArea.addEventListener("mousedown",e=>{
  slDragging=true; slThumb.classList.add('dragging');
  sliderFromX(e.clientX); e.preventDefault();
});
document.addEventListener("mousemove",e=>{
  if(slDragging) sliderFromX(e.clientX);
});
document.addEventListener("mouseup",()=>{
  if(slDragging){
    slDragging=false; slThumb.classList.remove('dragging');
    const a=aw(),s=si();
    if(a[s]) setTimeout(()=>speak(a[s].word),100);
  }
});

// Keyboard
document.addEventListener("keydown",e=>{
  if(e.key==="ArrowRight")navigateTo("left");
  else if(e.key==="ArrowLeft")navigateTo("right");
  else if(e.key===" "){e.preventDefault();flipCard();}
});

render();
setTimeout(()=>speak(WORDS[0].word),500);
</script>
</body>
</html>
