<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Spelling Bee</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800;900&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #d4af37;
  --gold-dim: rgba(212,175,55,0.5);
  --gold-glow: rgba(212,175,55,0.15);
  --bg: #0c0a13;
  --card: rgba(30,26,46,0.97);
  --text: #f0ece2;
  --text-dim: rgba(255,255,255,0.55);
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body {
  height: 100%; overflow: hidden;
  background: var(--bg); color: var(--text);
  font-family: 'DM Sans', sans-serif;
  -webkit-user-select: none; user-select: none;
  -webkit-tap-highlight-color: transparent;
  -webkit-text-size-adjust: 100%;
}
body {
  display: flex; flex-direction: column;
  padding-top: var(--safe-top);
  padding-bottom: var(--safe-bottom);
  background: linear-gradient(170deg, #0c0a13 0%, #1a1528 45%, #110e1c 100%);
}

/* Header */
.header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px 16px 6px; flex-shrink: 0;
}
.header-left { display: flex; align-items: center; gap: 9px; }
.header-left span { font-size: 22px; }
.header-left h1 {
  font-family: 'Playfair Display', serif;
  font-size: 20px; font-weight: 700; letter-spacing: 0.02em;
}
.mode-btn {
  display: flex; align-items: center; gap: 6px;
  padding: 5px 13px; border-radius: 20px;
  border: 1.5px solid rgba(255,255,255,0.18);
  background: transparent; color: var(--text-dim);
  font-size: 12px; font-weight: 500; cursor: pointer;
  font-family: 'DM Sans', sans-serif; transition: all 0.25s;
}
.mode-btn.active {
  background: var(--gold-glow); border-color: var(--gold); color: var(--gold);
}
.mode-btn svg { width: 14px; height: 14px; }

/* Card */
.card-area {
  flex: 1; display: flex; flex-direction: column;
  padding: 6px 10px 0; overflow: hidden;
}
.card {
  flex: 1; display: flex; flex-direction: column;
  background: linear-gradient(150deg, rgba(38,32,56,0.97), rgba(22,18,36,0.99));
  border-radius: 22px;
  border: 1px solid rgba(212,175,55,0.1);
  padding: 16px 16px 14px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.04);
  overflow-y: auto; overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  transition: transform 0.08s ease;
}
.card::-webkit-scrollbar { display: none; }
.card-top {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 12px; flex-shrink: 0;
}
.counter { font-size: 11px; color: rgba(255,255,255,0.3); font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; }
.side-label { font-size: 9px; font-weight: 700; letter-spacing: 0.16em; color: var(--gold-dim); text-transform: uppercase; }
.card-top-right { display: flex; align-items: center; gap: 10px; }
.mark-btn {
  background: none; border: none; cursor: pointer; padding: 2px;
  color: rgba(255,255,255,0.25); transition: all 0.2s;
}
.mark-btn.active { color: var(--gold); }
.mark-btn svg { width: 22px; height: 22px; }

/* Sections */
.sect { display: flex; flex-direction: column; gap: 3px; margin-bottom: 11px; }
.tag {
  font-size: 9px; font-weight: 700; letter-spacing: 0.16em;
  color: var(--gold); text-transform: uppercase; opacity: 0.75; margin-bottom: 1px;
}
.pron-main {
  font-family: 'Playfair Display', serif;
  font-size: 21px; font-weight: 700; letter-spacing: 0.05em;
}
.ipa { font-size: 13px; color: rgba(255,255,255,0.38); font-family: monospace; }
.listen-btn {
  display: inline-flex; align-items: center; gap: 7px;
  padding: 5px 14px; border-radius: 20px;
  border: 1px solid rgba(212,175,55,0.3); background: rgba(212,175,55,0.08);
  color: var(--gold); cursor: pointer; font-family: 'DM Sans', sans-serif;
  font-size: 12.5px; font-weight: 500; margin-top: 5px; align-self: flex-start;
  transition: all 0.2s;
}
.listen-btn:active { background: rgba(212,175,55,0.2); }
.listen-btn svg { width: 15px; height: 15px; }
.pos-chip {
  display: inline-block; padding: 3px 12px; border-radius: 14px;
  background: rgba(212,175,55,0.1); border: 1px solid rgba(212,175,55,0.22);
  color: var(--gold); font-size: 13px; font-weight: 600; font-style: italic;
}
.def-text { font-size: 14px; line-height: 1.6; color: rgba(255,255,255,0.85); }
.origin-text { font-size: 13px; line-height: 1.55; color: var(--text-dim); font-style: italic; }
.ex-text {
  font-size: 13px; line-height: 1.6; color: rgba(255,255,255,0.65);
  border-left: 3px solid rgba(212,175,55,0.35); padding-left: 12px; font-style: italic;
}

/* Tap hint */
.tap-hint {
  text-align: center; padding: 12px 0 4px;
  font-size: 12px; color: rgba(255,255,255,0.2);
  letter-spacing: 0.04em; flex-shrink: 0;
}

/* Back */
.back-content { display: flex; flex-direction: column; align-items: center; gap: 20px; padding-top: 6px; flex: 1; }
.spelling-box {
  text-align: center; width: 100%; padding: 22px 12px 18px;
  background: linear-gradient(135deg, rgba(212,175,55,0.07), rgba(212,175,55,0.02));
  border-radius: 16px; border: 1px solid rgba(212,175,55,0.15);
}
.spelling-label {
  font-size: 10px; font-weight: 700; letter-spacing: 0.22em;
  color: rgba(212,175,55,0.6); text-transform: uppercase; margin-bottom: 10px;
}
.spelling-word {
  font-family: 'Playfair Display', serif; font-size: 36px; font-weight: 900;
  letter-spacing: 0.04em; line-height: 1.15;
  text-shadow: 0 2px 16px rgba(212,175,55,0.2); margin-bottom: 14px;
}
.letters-row { display: flex; justify-content: center; gap: 3px; flex-wrap: wrap; }
.letter-tile {
  display: inline-flex; align-items: center; justify-content: center;
  width: 27px; height: 34px; border-radius: 6px;
  background: rgba(212,175,55,0.08); border: 1px solid rgba(212,175,55,0.2);
  color: var(--gold); font-family: 'Playfair Display', serif;
  font-size: 17px; font-weight: 700;
  animation: letterPop 0.35s cubic-bezier(0.34,1.56,0.64,1) both;
}
.image-box {
  width: 100%; border-radius: 14px; overflow: hidden;
  border: 1px solid rgba(255,255,255,0.08); position: relative;
  animation: popIn 0.4s cubic-bezier(0.34,1.56,0.64,1) both;
  animation-delay: 0.15s;
}
.word-img { width: 100%; height: 190px; object-fit: cover; display: block; }
.img-caption {
  position: absolute; bottom: 0; left: 0; right: 0;
  padding: 20px 14px 8px;
  background: linear-gradient(transparent, rgba(0,0,0,0.7));
  font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.7);
  letter-spacing: 0.06em; text-transform: capitalize;
}
.loading-box { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 20px 0; }
.spinner {
  width: 22px; height: 22px;
  border: 2.5px solid rgba(212,175,55,0.2);
  border-top-color: var(--gold); border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
.loading-text { color: rgba(255,255,255,0.35); font-size: 12px; }

/* Bottom bar */
.bottom-bar {
  flex-shrink: 0;
  padding: 10px 16px 12px;
  display: flex; flex-direction: column; gap: 6px;
}
.nav-row {
  display: flex; align-items: center; justify-content: center; gap: 12px;
}
.nav-arrow {
  display: flex; align-items: center; justify-content: center;
  width: 36px; height: 36px; border-radius: 50%;
  border: 1.5px solid rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.04);
  color: rgba(255,255,255,0.5); cursor: pointer;
  transition: all 0.2s; flex-shrink: 0;
}
.nav-arrow:active { background: rgba(212,175,55,0.15); border-color: var(--gold); color: var(--gold); transform: scale(0.92); }
.nav-arrow svg { width: 18px; height: 18px; }
.slider-area {
  flex: 1; height: 32px; position: relative;
  display: flex; align-items: center;
  touch-action: none; cursor: pointer;
}
.slider-track-bg {
  width: 100%; height: 3px; border-radius: 2px;
  background: rgba(255,255,255,0.08); position: relative; overflow: hidden;
}
.slider-fill {
  height: 100%; border-radius: 2px;
  background: linear-gradient(90deg, var(--gold), rgba(212,175,55,0.5));
  transition: width 0.15s ease;
}
.slider-dots {
  position: absolute; top: 0; left: 0; right: 0; bottom: 0;
  display: flex; align-items: center; justify-content: space-between;
  pointer-events: none; padding: 0 2px;
}
.slider-tick {
  width: 2px; height: 8px; border-radius: 1px;
  background: rgba(255,255,255,0.06); flex-shrink: 0;
}
.slider-tick.major { height: 12px; background: rgba(255,255,255,0.12); }
.slider-tick.active { background: var(--gold); height: 14px; width: 3px; border-radius: 1.5px; box-shadow: 0 0 6px rgba(212,175,55,0.4); }
.slider-thumb {
  position: absolute; top: 50%; transform: translate(-50%, -50%);
  width: 20px; height: 20px; border-radius: 50%;
  background: var(--gold);
  border: 2.5px solid #1a1528;
  box-shadow: 0 0 10px rgba(212,175,55,0.5), 0 2px 6px rgba(0,0,0,0.4);
  cursor: grab; transition: left 0.12s ease;
  z-index: 2;
}
.slider-thumb:active { cursor: grabbing; transform: translate(-50%, -50%) scale(1.15); }
.slider-thumb.dragging { transition: none; transform: translate(-50%, -50%) scale(1.15); }
.slider-counter {
  text-align: center; font-size: 11px; font-weight: 600;
  color: rgba(255,255,255,0.25); letter-spacing: 0.08em;
}

/* Animations */
@keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
@keyframes popIn { 0% { transform: scale(0.92); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
@keyframes letterPop { 0% { transform: scale(0) rotate(-8deg); opacity: 0; } 60% { transform: scale(1.1) rotate(2deg); opacity: 1; } 100% { transform: scale(1) rotate(0); opacity: 1; } }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes slideOutL { from { transform: translateX(0); opacity: 1; } to { transform: translateX(-105%); opacity: 0; } }
@keyframes slideOutR { from { transform: translateX(0); opacity: 1; } to { transform: translateX(105%); opacity: 0; } }
.slide-out-l { animation: slideOutL 0.22s ease forwards; }
.slide-out-r { animation: slideOutR 0.22s ease forwards; }
.fade-in { animation: fadeUp 0.3s ease both; }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <span>üêù</span>
    <h1>Spelling Bee</h1>
  </div>
  <button class="mode-btn" id="modeBtn" onclick="toggleMarkedOnly()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
    <span id="modeBtnText">All (6)</span>
  </button>
</div>

<div class="card-area" id="cardArea">
  <div class="card" id="card"></div>
</div>

<div class="bottom-bar">
  <div class="nav-row">
    <button class="nav-arrow" id="prevBtn" onclick="navigateTo('right')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <div class="slider-area" id="sliderArea">
      <div class="slider-track-bg">
        <div class="slider-fill" id="sliderFill"></div>
      </div>
      <div class="slider-dots" id="sliderDots"></div>
      <div class="slider-thumb" id="sliderThumb"></div>
    </div>
    <button class="nav-arrow" id="nextBtn" onclick="navigateTo('left')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 6 15 12 9 18"/></svg>
    </button>
  </div>
  <div class="slider-counter" id="sliderCounter">1 / 208</div>
</div>

<script>
const WORDS = [
  { word:'facade', pronunciation:'fuh-SAHD', ipa:'/f…ôÀàs…ëÀêd/', pos:'noun', def:'The front of a building, especially an imposing one; an outward appearance maintained to conceal a less pleasant reality.', lang:'French, from fa√ßade (\'front of a building\'), from Italian facciata (\'front\'), from faccia (\'face\'), from Latin facies (\'face, form\').', example:'Behind the cheerful facade, the company was struggling with serious financial problems that would soon become public.', isNoun:true },
  { word:'factorial', pronunciation:'fak-TOR-ee-ul', ipa:'/f√¶kÀàt…îÀêri…ôl/', pos:'noun', def:'The product of an integer and all the integers below it, denoted by the symbol \'!\'; relating to a factor or factory.', lang:'Latin, from factor (\'maker, doer\'), from facere (\'to make, do\'), + -ial.', example:'In mathematics class, the students learned that five factorial, written as 5!, equals one hundred and twenty.', isNoun:true },
  { word:'fadeaway', pronunciation:'FAYD-uh-way', ipa:'/Ààfe…™d…ôÀåwe…™/', pos:'noun', def:'A type of shot in basketball made while jumping or leaning backward away from the basket; a gradual disappearance.', lang:'English, from fade + away, describing the motion of moving back while shooting.', example:'The basketball player launched a fadeaway jumper over the defender\'s outstretched hand, sinking the game-winning shot.', isNoun:true },
  { word:'fallacy', pronunciation:'FAL-uh-see', ipa:'/Ààf√¶l…ôsi/', pos:'noun', def:'A mistaken belief, especially one based on unsound reasoning; a flaw in logical argument.', lang:'Latin, from fallacia (\'deception, trick\'), from fallax (\'deceptive\'), from fallere (\'to deceive\').', example:'The argument contained a logical fallacy, assuming that because two events occurred together, one must have caused the other.', isNoun:true },
  { word:'fanatic', pronunciation:'fuh-NAT-ik', ipa:'/f…ôÀàn√¶t…™k/', pos:'noun', def:'A person filled with excessive and single-minded enthusiasm, especially for a cause or belief.', lang:'Latin, from fanaticus (\'mad, enthusiastic, inspired by a god\'), from fanum (\'temple\').', example:'He was such a football fanatic that he had never missed a home game in over twenty consecutive seasons.', isNoun:true },
  { word:'fanfic', pronunciation:'FAN-fik', ipa:'/Ààf√¶nÀåf…™k/', pos:'noun', def:'Fiction written by fans of a movie, book, television show, or other work, using existing characters and settings.', lang:'English, a shortened form of fan fiction, from fan (short for fanatic) + fiction.', example:'The teenager spent her evenings writing fanfic set in the world of her favorite fantasy novel series.', isNoun:true },
  { word:'feeble', pronunciation:'FEE-bul', ipa:'/ÀàfiÀêb…ôl/', pos:'adjective', def:'Lacking physical strength, especially as a result of age or illness; weak and unconvincing.', lang:'Old French, from feble (\'weak\'), from Latin flebilis (\'lamentable, worthy of tears\'), from flere (\'to weep\').', example:'The feeble kitten could barely stand, but with careful nursing, it grew into a strong and healthy cat.', isNoun:false },
  { word:'fellowship', pronunciation:'FEL-oh-ship', ipa:'/Ààf…õlo äÀå É…™p/', pos:'noun', def:'A group of people sharing a common interest; friendly association with others; a grant of money for academic research.', lang:'Old English, from feolaga (\'partner, companion\'), from Old Norse f√©lagi (\'one who lays down money\'), from f√© (\'money\') + lag (\'a laying down\'), + -ship.', example:'The fellowship of hikers met every Saturday morning to explore new trails in the surrounding mountains.', isNoun:true },
  { word:'felonious', pronunciation:'fuh-LOH-nee-us', ipa:'/f…ôÀàlo äni…ôs/', pos:'adjective', def:'Relating to or involved in crime; criminal; wicked or villainous.', lang:'Old French, from felonie (\'wickedness, treachery\'), from felon (\'wicked person, criminal\'), of uncertain origin, + -ous.', example:'The suspect was charged with felonious assault after the victim identified him from a police lineup.', isNoun:false },
  { word:'ferret', pronunciation:'FAIR-it', ipa:'/Ààf…õr…™t/', pos:'noun', def:'A small, domesticated mammal related to the weasel, kept as a pet or used for hunting rabbits; to search tenaciously.', lang:'Old French, from furet (\'ferret\'), diminutive of Latin fur (\'thief\'), referring to the animal\'s habit of stealing.', example:'The curious ferret squeezed through a gap in the fence and spent the afternoon exploring the neighbor\'s garden.', isNoun:true },
  { word:'fervently', pronunciation:'FUR-vunt-lee', ipa:'/Ààf…úÀêrv…ôntli/', pos:'adverb', def:'In a passionate, intense, or enthusiastic manner; with great warmth of feeling.', lang:'Latin, from ferventem, present participle of fervere (\'to boil, glow, be hot\'), + -ly.', example:'The fans fervently cheered for their team, their voices echoing through the stadium as the final seconds ticked away.', isNoun:false },
  { word:'fiction', pronunciation:'FIK-shun', ipa:'/Ààf…™k É…ôn/', pos:'noun', def:'Literature in the form of prose that describes imaginary events and people; something invented or untrue.', lang:'Latin, from fictio (\'a fashioning, feigning\'), from fingere (\'to shape, form, invent\').', example:'Her debut work of fiction was a gripping mystery novel that kept readers guessing until the very last page.', isNoun:true },
  { word:'fidelity', pronunciation:'fih-DEL-ih-tee', ipa:'/f…™Ààd…õl…™ti/', pos:'noun', def:'Faithfulness to a person, cause, or belief; the degree of exactness with which something is copied or reproduced.', lang:'Latin, from fidelitas (\'faithfulness\'), from fidelis (\'faithful\'), from fides (\'faith, trust\').', example:'The film\'s fidelity to the original novel impressed both critics and devoted fans of the book.', isNoun:true },
  { word:'fie', pronunciation:'FYE', ipa:'/fa…™/', pos:'interjection', def:'An exclamation used to express disgust or outrage; an expression of disapproval.', lang:'Old French, from fi (\'expression of disgust\'), probably of imitative origin, expressing a natural reaction to something unpleasant.', example:'\'Fie!\' she exclaimed dramatically, pretending to be shocked when her brother ate the last cookie.', isNoun:false },
  { word:'fiendishly', pronunciation:'FEEND-ish-lee', ipa:'/ÀàfiÀênd…™ Éli/', pos:'adverb', def:'In an extremely cruel or unpleasant manner; extremely cleverly or complexly.', lang:'Old English, from fƒìond (\'enemy, devil\'), of Germanic origin, + -ish + -ly.', example:'The crossword puzzle was fiendishly difficult, with obscure clues that stumped even the most experienced solvers.', isNoun:false },
  { word:'fife', pronunciation:'FYFE', ipa:'/fa…™f/', pos:'noun', def:'A small, high-pitched flute used mainly with drums in military bands and parades.', lang:'German, from Pfeife (\'pipe, fife\'), or from Swiss German pfife, of imitative origin.', example:'The fife player led the marching band through the town square, the instrument\'s shrill notes cutting through the air.', isNoun:true },
  { word:'filar', pronunciation:'FY-lur', ipa:'/Ààfa…™l…ôr/', pos:'adjective', def:'Of or relating to a thread or threads; having threads or threadlike lines, especially in optical instruments.', lang:'Latin, from filum (\'thread\') + -ar.', example:'The astronomer adjusted the filar micrometer in the telescope to measure the angular distance between the two stars.', isNoun:false },
  { word:'filbert', pronunciation:'FIL-burt', ipa:'/Ààf…™lb…ôrt/', pos:'noun', def:'A cultivated hazelnut, especially one with a long husk that encloses the entire nut.', lang:'Anglo-French, from philbert, named after St. Philibert of Jumi√®ges, whose feast day (August 22) coincides with the ripening of the nuts.', example:'She added toasted filberts to the chocolate batter, their rich, nutty flavor complementing the dark cocoa perfectly.', isNoun:true },
  { word:'financier', pronunciation:'FIN-an-SEER', ipa:'/Àåf…™n√¶nÀàs…™…ôr/', pos:'noun', def:'A person who manages or provides money for businesses or large financial operations; a wealthy investor.', lang:'French, from financier, from finance (\'money, revenue\'), from Old French finer (\'to pay, settle a debt\'), from fin (\'end, settlement\').', example:'The financier invested millions in renewable energy startups, believing clean technology was the future of business.', isNoun:true },
  { word:'fission', pronunciation:'FISH-un', ipa:'/Ààf…™ É…ôn/', pos:'noun', def:'The splitting of an atomic nucleus into two or more parts, releasing a large amount of energy; division or splitting.', lang:'Latin, from fissio (\'a splitting, cleaving\'), from fissus, past participle of findere (\'to split, cleave\').', example:'Nuclear fission was first demonstrated in 1938 and later harnessed to generate electricity in power plants worldwide.', isNoun:true },
  { word:'flabbergast', pronunciation:'FLAB-ur-gast', ipa:'/Ààfl√¶b…ôrÀå…°√¶st/', pos:'verb', def:'To surprise someone greatly; to astonish or overwhelm with shock.', lang:'English, of uncertain origin, possibly a blend of flabby or flap + aghast, first appearing in the late 18th century.', example:'The surprise announcement absolutely flabbergasted the audience, leaving everyone speechless for several seconds.', isNoun:false },
  { word:'flashback', pronunciation:'FLASH-bak', ipa:'/Ààfl√¶ ÉÀåb√¶k/', pos:'noun', def:'A scene in a movie or novel set in a time earlier than the main story; a sudden, vivid memory of a past event.', lang:'English, from flash + back, originally a cinema term from the early 20th century.', example:'The novel used a powerful flashback to reveal the protagonist\'s childhood trauma that shaped her adult decisions.', isNoun:true },
  { word:'flavor', pronunciation:'FLAY-vur', ipa:'/Ààfle…™v…ôr/', pos:'noun', def:'The distinctive taste of a food or drink; a particular quality or character.', lang:'Old French, from flaor (\'smell, odor\'), probably from Latin flatus (\'a blowing, breath\'), from flare (\'to blow\'), influenced by savor.', example:'The ice cream shop offered over thirty flavors, from classic vanilla to exotic mango chili and lavender honey.', isNoun:true },
  { word:'fleeciness', pronunciation:'FLEE-see-nus', ipa:'/ÀàfliÀêsin…™s/', pos:'noun', def:'The quality of being soft, light, and fluffy like fleece or wool.', lang:'English, from fleecy + -ness. Fleece from Old English flƒìos (\'wool, sheepskin\'), of Germanic origin.', example:'The fleeciness of the new blanket made it irresistibly cozy, perfect for curling up with a book on cold evenings.', isNoun:true },
  { word:'fleetness', pronunciation:'FLEET-nus', ipa:'/ÀàfliÀêtn…™s/', pos:'noun', def:'The quality of being fast and nimble; swiftness of movement.', lang:'Old English, from flƒìot (\'swift, nimble\') + -ness, of Germanic origin.', example:'The cheetah\'s legendary fleetness allows it to reach speeds of over seventy miles per hour in short bursts.', isNoun:true },
  { word:'flexitarian', pronunciation:'FLEK-sih-TAIR-ee-un', ipa:'/Àåfl…õks…™Ààt…õ…ôri…ôn/', pos:'noun', def:'A person who has a primarily vegetarian diet but occasionally eats meat or fish.', lang:'English, a blend of flexible + vegetarian, coined in the early 2000s.', example:'As a flexitarian, she ate mostly plant-based meals but enjoyed a good steak once or twice a month.', isNoun:true },
  { word:'flight', pronunciation:'FLYTE', ipa:'/fla…™t/', pos:'noun', def:'The action or process of flying through the air; a journey made by air; a series of stairs between floors.', lang:'Old English, from flyht (\'a flying, flight\'), from flƒìogan (\'to fly\'), of Germanic origin.', example:'The flight from New York to London took about seven hours, and she slept through most of it.', isNoun:true },
  { word:'flipperling', pronunciation:'FLIP-ur-ling', ipa:'/Ààfl…™p…ôrl…™≈ã/', pos:'noun', def:'A young or small creature with flippers; sometimes used to describe a very young seal or similar marine mammal.', lang:'English, from flipper + -ling (diminutive suffix), suggesting a small flippered creature.', example:'The wildlife photographer captured an adorable image of a flipperling seal pup learning to swim in the icy waters.', isNoun:true },
  { word:'floridly', pronunciation:'FLOR-id-lee', ipa:'/Ààfl…ír…™dli/', pos:'adverb', def:'In an excessively elaborate or ornate manner; with a flushed, reddish complexion.', lang:'Latin, from floridus (\'blooming, flowery\'), from flos (genitive floris, \'flower\'), + -ly.', example:'The author wrote floridly, filling every page with ornate descriptions and elaborate metaphors that some readers found excessive.', isNoun:false },
  { word:'flounder', pronunciation:'FLOUN-dur', ipa:'/Ààfla änd…ôr/', pos:'verb', def:'To struggle or stagger helplessly or clumsily; to be in serious difficulty; also, a flat edible sea fish.', lang:'English, possibly a blend of founder (\'to sink\') and blunder (\'to stumble\'), or from Dutch flodderen (\'to flop about\').', example:'The new employee floundered during her first presentation but gradually gained confidence with each subsequent one.', isNoun:false },
  { word:'flourish', pronunciation:'FLUR-ish', ipa:'/Ààfl…úÀêr…™ É/', pos:'verb', def:'To grow or develop in a healthy or vigorous way; to thrive; to wave something about dramatically.', lang:'Old French, from floriss- (stem of florir, \'to bloom\'), from Latin florere (\'to flower, bloom\'), from flos (\'flower\').', example:'The garden flourished under her care, producing an abundance of tomatoes, herbs, and sunflowers all summer long.', isNoun:false },
  { word:'flout', pronunciation:'FLOWT', ipa:'/fla ät/', pos:'verb', def:'To openly disregard a rule, law, or convention; to show contempt for.', lang:'Dutch, from fluiten (\'to whistle, play the flute, mock\'), possibly of imitative origin.', example:'The driver continued to flout the speed limit despite having already received two tickets that month.', isNoun:false },
  { word:'fluctuation', pronunciation:'FLUK-choo-AY-shun', ipa:'/Àåfl åkt ÉuÀàe…™ É…ôn/', pos:'noun', def:'An irregular rising and falling in number or amount; a variation or instability.', lang:'Latin, from fluctuatio (\'a wavering\'), from fluctuare (\'to wave, undulate\'), from fluctus (\'a flowing, wave\'), from fluere (\'to flow\').', example:'The fluctuation in oil prices made it difficult for airlines to plan their budgets for the coming year.', isNoun:true },
  { word:'fluid', pronunciation:'FLOO-id', ipa:'/ÀàfluÀê…™d/', pos:'noun', def:'A substance that has no fixed shape and yields easily to external pressure; a gas or liquid. Also, smooth and graceful.', lang:'Latin, from fluidus (\'flowing\'), from fluere (\'to flow\').', example:'The dancer\'s movements were so fluid that she seemed to glide across the stage like water flowing over stones.', isNoun:true },
  { word:'flummery', pronunciation:'FLUM-uh-ree', ipa:'/Ààfl åm…ôri/', pos:'noun', def:'Empty or insincere compliments or flattery; meaningless or deceptive talk; also, a sweet dessert made with beaten eggs and sugar.', lang:'Welsh, from llymru (\'soft jelly from sour oatmeal\'), from llymrig (\'harsh, raw\').', example:'The politician\'s speech was dismissed as pure flummery, full of grand promises but entirely lacking in substance.', isNoun:true },
  { word:'foible', pronunciation:'FOY-bul', ipa:'/Ààf…î…™b…ôl/', pos:'noun', def:'A minor weakness or eccentricity in someone\'s character; a small flaw or failing.', lang:'French, from faible (\'weak\'), from Latin flebilis (\'lamentable\'), from flere (\'to weep\'). In fencing, the weaker part of a sword blade.', example:'Everyone has their foibles; his happened to be an inability to resist buying books he would never have time to read.', isNoun:true },
  { word:'folate', pronunciation:'FOH-layt', ipa:'/Ààfo äle…™t/', pos:'noun', def:'A B vitamin (B9) found naturally in foods, essential for cell growth and the formation of DNA; the natural form of folic acid.', lang:'Latin, from folium (\'leaf\'), because it was first isolated from spinach leaves, + -ate.', example:'Pregnant women are advised to consume foods rich in folate, such as leafy greens and legumes, to support healthy fetal development.', isNoun:true },
  { word:'folklore', pronunciation:'FOHK-lor', ipa:'/Ààfo äkÀål…îÀêr/', pos:'noun', def:'The traditional beliefs, customs, stories, songs, and sayings of a community, passed through generations by word of mouth.', lang:'English, coined by W.J. Thoms in 1846, from folk (\'people\'), from Old English folc, + lore (\'knowledge, tradition\'), from Old English lƒÅr.', example:'The region\'s folklore included tales of a mysterious lake creature that supposedly appeared only during full moons.', isNoun:true },
  { word:'folly', pronunciation:'FOL-ee', ipa:'/Ààf…íli/', pos:'noun', def:'Lack of good sense; foolishness; a costly ornamental building with no practical purpose.', lang:'Old French, from folie (\'madness, foolishness\'), from fol (\'fool, mad\'), from Latin follis (\'bellows, windbag\').', example:'Building the elaborate treehouse without any construction experience turned out to be an expensive folly.', isNoun:true },
  { word:'fomentation', pronunciation:'FOH-men-TAY-shun', ipa:'/Àåfo äm…õnÀàte…™ É…ôn/', pos:'noun', def:'The application of warm, moist substances to the body to ease pain; the act of instigating or stirring up trouble.', lang:'Latin, from fomentatio (\'a warm application\'), from fomentare (\'to apply a warm poultice\'), from fovere (\'to warm, cherish\').', example:'The fomentation of unrest among the workers eventually led to a full-scale strike that shut down the factory.', isNoun:true },
  { word:'foosball', pronunciation:'FOOZ-bawl', ipa:'/ÀàfuÀêzÀåb…îÀêl/', pos:'noun', def:'A tabletop game modeled after soccer, in which rows of miniature players are mounted on rotating bars and used to kick a small ball.', lang:'German, from Fu√üball (\'football, soccer\'), from Fu√ü (\'foot\') + Ball (\'ball\').', example:'The break room had a foosball table where coworkers gathered for intense lunchtime tournaments.', isNoun:true },
  { word:'foozle', pronunciation:'FOO-zul', ipa:'/ÀàfuÀêz…ôl/', pos:'verb', def:'To bungle or botch something, especially a shot in golf; to do something clumsily.', lang:'German, possibly from fuseln (\'to work clumsily, bungle\'), of dialectal origin.', example:'He managed to foozle the easiest putt of the day, sending the ball rolling right past the hole.', isNoun:false },
  { word:'foppery', pronunciation:'FOP-uh-ree', ipa:'/Ààf…íp…ôri/', pos:'noun', def:'The behavior or dress of a fop; excessive concern with appearance and elegance; foolish vanity.', lang:'English, from fop (\'a vain person excessively concerned with appearance\'), of uncertain origin, possibly related to German foppen (\'to mock\'), + -ery.', example:'Shakespeare\'s characters often mock foppery, ridiculing noblemen who care more about their clothes than their character.', isNoun:true },
  { word:'forecast', pronunciation:'FOR-kast', ipa:'/Ààf…îÀêrÀåk√¶st/', pos:'noun', def:'A prediction or estimate of future events, especially coming weather conditions or financial trends.', lang:'English, from fore- (\'before\') + cast (\'to throw, calculate\'), from Old Norse kasta (\'to throw\').', example:'The weather forecast predicted sunny skies for the weekend, perfect for the outdoor music festival.', isNoun:true },
  { word:'forensics', pronunciation:'fuh-REN-ziks', ipa:'/f…ôÀàr…õnz…™ks/', pos:'noun', def:'Scientific tests or techniques used in connection with the detection of crime; the art of formal public debate.', lang:'Latin, from forensis (\'of the forum, public\'), from forum (\'public place, marketplace\'), because Roman legal cases were argued in the forum.', example:'The forensics team collected DNA samples from the crime scene that ultimately led to the identification of the suspect.', isNoun:true },
  { word:'forfeit', pronunciation:'FOR-fit', ipa:'/Ààf…îÀêrf…™t/', pos:'verb', def:'To lose or be deprived of something as a penalty for wrongdoing; to give up something voluntarily.', lang:'Old French, from forfait (\'crime, offense\'), past participle of forfaire (\'to commit a crime\'), from for- (\'beyond\') + faire (\'to do\'), from Latin facere.', example:'The team had to forfeit the game because they could not field enough players after three members were injured.', isNoun:false },
  { word:'forgeable', pronunciation:'FOR-juh-bul', ipa:'/Ààf…îÀêrd í…ôb…ôl/', pos:'adjective', def:'Capable of being forged or shaped by heating and hammering; able to be counterfeited or fabricated.', lang:'Old French, from forge (\'a smithy\'), from Latin fabrica (\'workshop\'), from faber (\'craftsman\'), + -able.', example:'The blacksmith explained that the alloy was highly forgeable, making it ideal for crafting intricate decorative ironwork.', isNoun:false },
  { word:'formalize', pronunciation:'FOR-muh-lyze', ipa:'/Ààf…îÀêrm…ôÀåla…™z/', pos:'verb', def:'To give something a definite structure or official status; to make a process or arrangement official.', lang:'Latin, from formalis (\'of or pertaining to form\'), from forma (\'shape, form\'), + -ize.', example:'The two companies met to formalize their partnership agreement, signing contracts and setting clear expectations.', isNoun:false },
  { word:'fortification', pronunciation:'FOR-tih-fih-KAY-shun', ipa:'/Àåf…îÀêrt…™f…™Ààke…™ É…ôn/', pos:'noun', def:'A defensive wall or other reinforcement built to strengthen a place against attack; the action of fortifying.', lang:'Latin, from fortificatio, from fortificare (\'to strengthen\'), from fortis (\'strong\') + facere (\'to make\').', example:'The ancient fortification surrounding the hilltop city had withstood sieges for centuries, its walls still standing tall.', isNoun:true },
  { word:'fractions', pronunciation:'FRAK-shunz', ipa:'/Ààfr√¶k É…ônz/', pos:'noun', def:'Numerical quantities that are not whole numbers, expressed as one number divided by another; small or tiny parts of something.', lang:'Latin, from fractio (\'a breaking\'), from frangere (\'to break\').', example:'The math teacher used pizza slices to help the young students visualize fractions in a fun and memorable way.', isNoun:true },
  { word:'frailty', pronunciation:'FRAYL-tee', ipa:'/Ààfre…™lti/', pos:'noun', def:'The condition of being weak and delicate; weakness in character or morals.', lang:'Old French, from frailet√© (\'weakness\'), from Latin fragilitas (\'brittleness\'), from fragilis (\'easily broken\'), from frangere (\'to break\').', example:'Despite her physical frailty in old age, her mind remained as sharp and witty as it had been in her youth.', isNoun:true },
  { word:'fraying', pronunciation:'FRAY-ing', ipa:'/Ààfre…™…™≈ã/', pos:'verb', def:'Becoming worn at the edge, with threads coming loose; gradually deteriorating or coming apart.', lang:'Old French, from frayer (\'to rub\'), from Latin fricare (\'to rub\').', example:'The old rope was fraying at both ends, and the climbers decided it was no longer safe to use.', isNoun:false },
  { word:'freakishly', pronunciation:'FREEK-ish-lee', ipa:'/ÀàfriÀêk…™ Éli/', pos:'adverb', def:'In a very unusual or abnormal manner; to an unexpected or extreme degree.', lang:'English, from freak (possibly from Old English frician, \'to dance\') + -ish + -ly.', example:'The basketball player was freakishly tall for his age, already standing well over six feet at just fourteen years old.', isNoun:false },
  { word:'freegan', pronunciation:'FREE-gun', ipa:'/ÀàfriÀê…°…ôn/', pos:'noun', def:'A person who rejects consumerism and seeks to reduce waste by eating discarded food and using reclaimed materials.', lang:'English, a blend of free + vegan, coined in the mid-1990s.', example:'The freegan found perfectly good fruits and vegetables in the supermarket dumpster that had been thrown out simply because they were slightly bruised.', isNoun:true },
  { word:'freight', pronunciation:'FRAYT', ipa:'/fre…™t/', pos:'noun', def:'Goods transported in bulk by truck, train, ship, or aircraft; the transport of goods by such means.', lang:'Dutch, from vracht (\'cargo, freight\'), related to German Fracht, of Low German origin.', example:'The freight train rumbled through town at midnight, its hundred cars loaded with coal, grain, and steel.', isNoun:true },
  { word:'fribble', pronunciation:'FRIB-ul', ipa:'/Ààfr…™b…ôl/', pos:'noun', def:'A frivolous or foolish person; a trifling thing or activity; to act in a frivolous way.', lang:'English, of uncertain origin, possibly related to frivolous or an imitative formation suggesting something trivial.', example:'He dismissed the argument as mere fribble, insisting they focus on the serious issues facing the committee.', isNoun:true },
  { word:'frisket', pronunciation:'FRIS-kit', ipa:'/Ààfr…™sk…™t/', pos:'noun', def:'A mask used in printing, airbrushing, or painting to protect areas that should not receive ink or paint.', lang:'French, from frisquette (\'a protective sheet\'), possibly from Spanish frasqueta, of uncertain origin.', example:'The artist carefully cut a frisket to shield the background while spraying color onto the foreground of her illustration.', isNoun:true },
  { word:'frock', pronunciation:'FROK', ipa:'/fr…ík/', pos:'noun', def:'A woman\'s or girl\'s dress; a loose outer garment, especially a long gown worn by monks or priests.', lang:'Old French, from froc (\'monk\'s habit\'), of Germanic origin, related to Old High German hroc (\'coat, mantle\').', example:'The little girl twirled happily in her new floral frock, delighted by the way the skirt fanned out around her.', isNoun:true },
  { word:'frontier', pronunciation:'frun-TEER', ipa:'/fr ånÀàt…™…ôr/', pos:'noun', def:'A border separating two countries; the extreme limit of settled land; the boundary of knowledge or achievement.', lang:'Old French, from front (\'front, forehead\'), from Latin frons (genitive frontis, \'forehead, front\'), + -ier.', example:'Space has been called the final frontier, a vast unknown that humanity is only beginning to explore.', isNoun:true },
  { word:'fundamental', pronunciation:'FUN-duh-MEN-tul', ipa:'/Àåf ånd…ôÀàm…õnt…ôl/', pos:'adjective', def:'Forming a necessary base or core; of central importance; affecting the basic nature of something.', lang:'Latin, from fundamentalis, from fundamentum (\'foundation\'), from fundare (\'to found, lay the bottom\'), from fundus (\'bottom\').', example:'Freedom of speech is a fundamental right protected by the constitution and essential to a functioning democracy.', isNoun:false },
  { word:'funnel', pronunciation:'FUN-ul', ipa:'/Ààf ån…ôl/', pos:'noun', def:'A cone-shaped utensil with a wide mouth and narrow stem, used to pour liquids into small openings; a chimney on a ship.', lang:'Proven√ßal, from fonilh (\'funnel\'), from Latin fundibulum (\'funnel\'), from infundere (\'to pour in\'), from in- (\'into\') + fundere (\'to pour\').', example:'She used a funnel to pour the homemade salad dressing into a narrow-necked bottle without spilling a drop.', isNoun:true },
  { word:'futility', pronunciation:'fyoo-TIL-ih-tee', ipa:'/fjuÀêÀàt…™l…™ti/', pos:'noun', def:'Pointlessness or uselessness; lack of purpose or effectiveness.', lang:'Latin, from futilitas (\'worthlessness\'), from futilis (\'leaky, worthless, futile\'), from fundere (\'to pour\'), suggesting something that cannot hold anything.', example:'After hours of trying to fix the ancient computer, he finally accepted the futility of his efforts and bought a new one.', isNoun:true }
];

let currentIndex = 0, flipped = false, markedWords = new Set(), markedOnly = false;
let imageCache = {}, imageLoading = {};
let touchStartX = 0, swipeX = 0;

function aw() { return markedOnly ? WORDS.filter((_,i) => markedWords.has(i)) : WORDS; }
function si() { const a=aw(); if(markedOnly){const i=a.findIndex(w=>w.word===WORDS[currentIndex]?.word);return i>=0?i:0;} return currentIndex; }
function gi() { const a=aw(),s=si(); return WORDS.findIndex(w=>w.word===a[s]?.word); }

function speak(t) { speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance(t); u.rate=0.85;u.pitch=1;u.lang="en-US"; speechSynthesis.speak(u); }

async function fetchImage(word) {
  if(imageCache[word]||imageLoading[word]) return;
  imageLoading[word]=true;
  // Update just the image placeholder if it exists
  const imgPlaceholder = document.getElementById('img-'+word);
  if(imgPlaceholder) imgPlaceholder.innerHTML=`<div class="loading-box"><div class="spinner"></div><span class="loading-text">Finding image‚Ä¶</span></div>`;
  try {
    const r=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1000,messages:[{role:"user",content:'Search online and find a direct image URL for "'+word+'". Return ONLY the raw URL ending in .jpg/.jpeg/.png/.svg/.webp. No markdown, no explanation.'}],tools:[{type:"web_search_20250305",name:"web_search"}]})});
    const d=await r.json(); const t=d.content.map(b=>b.type==="text"?b.text:"").filter(Boolean).join("\n").trim();
    const m=t.match(/https?:\/\/[^\s"'<>\)]+\.(jpg|jpeg|png|svg|webp)([^\s"'<>\)]*)*/i);
    imageCache[word]=m?m[0]:null;
  } catch(e){imageCache[word]=null;}
  imageLoading[word]=false;
  // Update just the image placeholder if still on same word
  const imgEl = document.getElementById('img-'+word);
  if(imgEl && imageCache[word]) {
    imgEl.innerHTML=`<div class="image-box"><img class="word-img" src="${imageCache[word]}" alt="${word}" onerror="this.parentElement.style.display='none'"><div class="img-caption">${word}</div></div>`;
  } else if(imgEl) {
    imgEl.innerHTML='';
  }
}

const starSvg=f=>`<svg viewBox="0 0 24 24" fill="${f?'currentColor':'none'}" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`;
const speakerSvg=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>`;

function renderFront(w) {
  return `
    <div class="sect fade-in"><div class="tag">PRONUNCIATION</div><div class="pron-main">${w.pronunciation}</div><div class="ipa">${w.ipa}</div>
      <button class="listen-btn" onclick="event.stopPropagation();speak('${w.word}')">${speakerSvg}<span>Listen</span></button></div>
    <div class="sect fade-in" style="animation-delay:.06s"><div class="tag">PART OF SPEECH</div><span class="pos-chip">${w.pos}</span></div>
    <div class="sect fade-in" style="animation-delay:.12s"><div class="tag">DEFINITION</div><div class="def-text">${w.def}</div></div>
    <div class="sect fade-in" style="animation-delay:.18s"><div class="tag">LANGUAGE OF ORIGIN</div><div class="origin-text">${w.lang}</div></div>
    <div class="sect fade-in" style="animation-delay:.24s"><div class="tag">EXAMPLE</div><div class="ex-text">"${w.example.replace(new RegExp(w.word,'gi'),'________')}"</div></div>
    <div class="tap-hint fade-in" style="animation-delay:.3s">Tap card to reveal spelling</div>`;
}

function renderBack(w) {
  const letters=w.word.split("").map((c,i)=>`<span class="letter-tile" style="animation-delay:${i*0.04+0.12}s">${c}</span>`).join("");
  let img="";
  if(w.isNoun){
    let imgContent = "";
    if(imageLoading[w.word]) imgContent=`<div class="loading-box"><div class="spinner"></div><span class="loading-text">Finding image‚Ä¶</span></div>`;
    else if(imageCache[w.word]) imgContent=`<div class="image-box"><img class="word-img" src="${imageCache[w.word]}" alt="${w.word}" onerror="this.parentElement.style.display='none'"><div class="img-caption">${w.word}</div></div>`;
    img=`<div id="img-${w.word}">${imgContent}</div>`;
  }
  return `<div class="back-content">
    <div class="spelling-box" style="animation:popIn .4s cubic-bezier(.34,1.56,.64,1) both">
      <div class="spelling-label">THE WORD IS</div><h2 class="spelling-word">${w.word}</h2>
      <div class="letters-row">${letters}</div>
      <button class="listen-btn" style="margin:14px auto 0" onclick="event.stopPropagation();speak('${w.word}')">${speakerSvg}<span>Hear Again</span></button>
    </div>${img}
    <div class="tap-hint">Tap card to go back to clues</div></div>`;
}

function render() {
  const a=aw();
  if(!a.length){ document.getElementById("card").innerHTML=`<div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px"><p style="color:rgba(255,255,255,0.5);font-size:16px">No marked words yet.</p><button class="flip-btn" style="width:auto;padding:10px 24px" onclick="markedOnly=false;render()">‚Üê Show All</button></div>`; return; }
  const s=si(), g=gi(), w=a[s];

  document.getElementById("card").innerHTML=`<div class="card-top"><span class="counter">${s+1} / ${a.length}</span><div class="card-top-right"><span class="side-label">${flipped?'ANSWER':'CLUES'}</span><button class="mark-btn ${markedWords.has(g)?'active':''}" onclick="toggleMark(${g})">${starSvg(markedWords.has(g))}</button></div></div>`+(flipped?renderBack(w):renderFront(w));

  if(flipped && w.isNoun&&!imageCache[w.word]&&!imageLoading[w.word]) fetchImage(w.word);

  // Slider
  const totalA = a.length;
  const pct = totalA > 1 ? s / (totalA - 1) * 100 : 0;
  document.getElementById("sliderFill").style.width = pct + "%";
  const sliderArea = document.getElementById("sliderArea");
  const areaW = sliderArea.offsetWidth || 200;
  const pad = 10;
  const thumbLeft = pad + (pct / 100) * (areaW - pad * 2);
  const thumb = document.getElementById("sliderThumb");
  if(!thumb.classList.contains('dragging')) thumb.style.left = thumbLeft + "px";

  // Ticks - show ~20 evenly spaced markers
  const tickCount = Math.min(totalA, 20);
  let ticksHtml = '';
  for(let t=0; t<tickCount; t++){
    const ti = Math.round(t / (tickCount-1) * (totalA-1));
    const cls = ti===s ? 'active' : (t % 5 === 0 ? 'major' : '');
    ticksHtml += `<div class="slider-tick ${cls}"></div>`;
  }
  document.getElementById("sliderDots").innerHTML = ticksHtml;
  document.getElementById("sliderCounter").textContent = `${s+1} / ${totalA}`;

  // Mode btn
  const mb=document.getElementById("modeBtn");
  mb.className="mode-btn"+(markedOnly?" active":"");
  mb.querySelector("svg").setAttribute("fill",markedOnly?"currentColor":"none");
  document.getElementById("modeBtnText").textContent=(markedOnly?"Marked":"All")+` (${markedOnly?markedWords.size:WORDS.length})`;
}

function jumpTo(idx) {
  const a=aw(); if(idx<0||idx>=a.length) return;
  const g=WORDS.findIndex(w=>w.word===a[idx].word);
  flipped=false; currentIndex=g; render();
  setTimeout(()=>speak(a[idx].word),200);
}

function navigateTo(dir) {
  const a=aw(); if(!a.length) return;
  const s=si(), card=document.getElementById("card");
  card.classList.add(dir==="left"?"slide-out-l":"slide-out-r");
  flipped=false;
  setTimeout(()=>{
    card.classList.remove("slide-out-l","slide-out-r");
    const ni=dir==="left"?(s+1)%a.length:(s-1+a.length)%a.length;
    currentIndex=WORDS.findIndex(w=>w.word===a[ni].word);
    render(); setTimeout(()=>speak(a[ni].word),150);
  },220);
}

function flipCard(){flipped=!flipped;render();}
function toggleMark(g){markedWords.has(g)?markedWords.delete(g):markedWords.add(g);render();}
function toggleMarkedOnly(){if(!markedOnly&&markedWords.size===0)return;markedOnly=!markedOnly;flipped=false;render();}

// Swipe
const ca=document.getElementById("cardArea");
let swiped=false;
ca.addEventListener("touchstart",e=>{touchStartX=e.touches[0].clientX;swiped=false;},{passive:true});
ca.addEventListener("touchmove",e=>{swipeX=e.touches[0].clientX-touchStartX;if(Math.abs(swipeX)>15)swiped=true;},{passive:true});
ca.addEventListener("touchend",()=>{if(Math.abs(swipeX)>50)navigateTo(swipeX<0?"left":"right");swipeX=0;});

// Card tap to flip
const card=document.getElementById("card");
card.addEventListener("click",e=>{
  if(e.target.closest('button')||swiped) return;
  flipCard();
});

// Slider drag
const slArea=document.getElementById("sliderArea");
const slThumb=document.getElementById("sliderThumb");
let slDragging=false;
function sliderFromX(cx){
  const r=slArea.getBoundingClientRect();
  const pad=10;
  const p=Math.max(0,Math.min(1,(cx-r.left-pad)/(r.width-pad*2)));
  const a=aw(),idx=Math.round(p*(a.length-1));
  // Move thumb immediately for smooth feel
  const thumbLeft=pad+(p)*(r.width-pad*2);
  slThumb.style.left=thumbLeft+"px";
  if(idx!==si()){
    const g=WORDS.findIndex(w=>w.word===a[idx].word);
    flipped=false; currentIndex=g; render();
  }
}
slArea.addEventListener("touchstart",e=>{
  slDragging=true; slThumb.classList.add('dragging');
  sliderFromX(e.touches[0].clientX);
},{passive:true});
document.addEventListener("touchmove",e=>{
  if(slDragging) sliderFromX(e.touches[0].clientX);
},{passive:true});
document.addEventListener("touchend",()=>{
  if(slDragging){
    slDragging=false; slThumb.classList.remove('dragging');
    // Speak the word after releasing
    const a=aw(),s=si();
    if(a[s]) setTimeout(()=>speak(a[s].word),100);
  }
});
slArea.addEventListener("mousedown",e=>{
  slDragging=true; slThumb.classList.add('dragging');
  sliderFromX(e.clientX); e.preventDefault();
});
document.addEventListener("mousemove",e=>{
  if(slDragging) sliderFromX(e.clientX);
});
document.addEventListener("mouseup",()=>{
  if(slDragging){
    slDragging=false; slThumb.classList.remove('dragging');
    const a=aw(),s=si();
    if(a[s]) setTimeout(()=>speak(a[s].word),100);
  }
});

// Keyboard
document.addEventListener("keydown",e=>{
  if(e.key==="ArrowRight")navigateTo("left");
  else if(e.key==="ArrowLeft")navigateTo("right");
  else if(e.key===" "){e.preventDefault();flipCard();}
});

render();
setTimeout(()=>speak(WORDS[0].word),500);
</script>
</body>
</html>
