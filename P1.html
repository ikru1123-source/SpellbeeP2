<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Spelling Bee</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800;900&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #d4af37;
  --gold-dim: rgba(212,175,55,0.5);
  --gold-glow: rgba(212,175,55,0.15);
  --bg: #0c0a13;
  --card: rgba(30,26,46,0.97);
  --text: #f0ece2;
  --text-dim: rgba(255,255,255,0.55);
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body {
  height: 100%; overflow: hidden;
  background: var(--bg); color: var(--text);
  font-family: 'DM Sans', sans-serif;
  -webkit-user-select: none; user-select: none;
  -webkit-tap-highlight-color: transparent;
  -webkit-text-size-adjust: 100%;
}
body {
  display: flex; flex-direction: column;
  padding-top: var(--safe-top);
  padding-bottom: var(--safe-bottom);
  background: linear-gradient(170deg, #0c0a13 0%, #1a1528 45%, #110e1c 100%);
}

/* Header */
.header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px 16px 6px; flex-shrink: 0;
}
.header-left { display: flex; align-items: center; gap: 9px; }
.header-left span { font-size: 22px; }
.header-left h1 {
  font-family: 'Playfair Display', serif;
  font-size: 20px; font-weight: 700; letter-spacing: 0.02em;
}
.mode-btn {
  display: flex; align-items: center; gap: 6px;
  padding: 5px 13px; border-radius: 20px;
  border: 1.5px solid rgba(255,255,255,0.18);
  background: transparent; color: var(--text-dim);
  font-size: 12px; font-weight: 500; cursor: pointer;
  font-family: 'DM Sans', sans-serif; transition: all 0.25s;
}
.mode-btn.active {
  background: var(--gold-glow); border-color: var(--gold); color: var(--gold);
}
.mode-btn svg { width: 14px; height: 14px; }

/* Card */
.card-area {
  flex: 1; display: flex; flex-direction: column;
  padding: 6px 10px 0; overflow: hidden;
}
.card {
  flex: 1; display: flex; flex-direction: column;
  background: linear-gradient(150deg, rgba(38,32,56,0.97), rgba(22,18,36,0.99));
  border-radius: 22px;
  border: 1px solid rgba(212,175,55,0.1);
  padding: 16px 16px 14px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.04);
  overflow-y: auto; overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  transition: transform 0.08s ease;
}
.card::-webkit-scrollbar { display: none; }
.card-top {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 12px; flex-shrink: 0;
}
.counter { font-size: 11px; color: rgba(255,255,255,0.3); font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; }
.side-label { font-size: 9px; font-weight: 700; letter-spacing: 0.16em; color: var(--gold-dim); text-transform: uppercase; }
.card-top-right { display: flex; align-items: center; gap: 10px; }
.mark-btn {
  background: none; border: none; cursor: pointer; padding: 2px;
  color: rgba(255,255,255,0.25); transition: all 0.2s;
}
.mark-btn.active { color: var(--gold); }
.mark-btn svg { width: 22px; height: 22px; }

/* Sections */
.sect { display: flex; flex-direction: column; gap: 3px; margin-bottom: 11px; }
.tag {
  font-size: 9px; font-weight: 700; letter-spacing: 0.16em;
  color: var(--gold); text-transform: uppercase; opacity: 0.75; margin-bottom: 1px;
}
.pron-main {
  font-family: 'Playfair Display', serif;
  font-size: 21px; font-weight: 700; letter-spacing: 0.05em;
}
.ipa { font-size: 13px; color: rgba(255,255,255,0.38); font-family: monospace; }
.listen-btn {
  display: inline-flex; align-items: center; gap: 7px;
  padding: 5px 14px; border-radius: 20px;
  border: 1px solid rgba(212,175,55,0.3); background: rgba(212,175,55,0.08);
  color: var(--gold); cursor: pointer; font-family: 'DM Sans', sans-serif;
  font-size: 12.5px; font-weight: 500; margin-top: 5px; align-self: flex-start;
  transition: all 0.2s;
}
.listen-btn:active { background: rgba(212,175,55,0.2); }
.listen-btn svg { width: 15px; height: 15px; }
.pos-chip {
  display: inline-block; padding: 3px 12px; border-radius: 14px;
  background: rgba(212,175,55,0.1); border: 1px solid rgba(212,175,55,0.22);
  color: var(--gold); font-size: 13px; font-weight: 600; font-style: italic;
}
.def-text { font-size: 14px; line-height: 1.6; color: rgba(255,255,255,0.85); }
.origin-text { font-size: 13px; line-height: 1.55; color: var(--text-dim); font-style: italic; }
.ex-text {
  font-size: 13px; line-height: 1.6; color: rgba(255,255,255,0.65);
  border-left: 3px solid rgba(212,175,55,0.35); padding-left: 12px; font-style: italic;
}

/* Tap hint */
.tap-hint {
  text-align: center; padding: 12px 0 4px;
  font-size: 12px; color: rgba(255,255,255,0.2);
  letter-spacing: 0.04em; flex-shrink: 0;
}

/* Back */
.back-content { display: flex; flex-direction: column; align-items: center; gap: 20px; padding-top: 6px; flex: 1; }
.spelling-box {
  text-align: center; width: 100%; padding: 22px 12px 18px;
  background: linear-gradient(135deg, rgba(212,175,55,0.07), rgba(212,175,55,0.02));
  border-radius: 16px; border: 1px solid rgba(212,175,55,0.15);
}
.spelling-label {
  font-size: 10px; font-weight: 700; letter-spacing: 0.22em;
  color: rgba(212,175,55,0.6); text-transform: uppercase; margin-bottom: 10px;
}
.spelling-word {
  font-family: Verdana, Geneva, sans-serif; font-size: 36px; font-weight: 400;
  letter-spacing: 0.04em; line-height: 1.15;
  text-shadow: 0 2px 16px rgba(212,175,55,0.2); margin-bottom: 14px;
}
.letters-row { display: flex; justify-content: center; gap: 3px; flex-wrap: wrap; }
.letter-tile {
  display: inline-flex; align-items: center; justify-content: center;
  width: 27px; height: 34px; border-radius: 6px;
  background: rgba(212,175,55,0.08); border: 1px solid rgba(212,175,55,0.2);
  color: var(--gold); font-family: 'Playfair Display', serif;
  font-size: 17px; font-weight: 700;
  animation: letterPop 0.35s cubic-bezier(0.34,1.56,0.64,1) both;
}
.image-box {
  width: 100%; border-radius: 14px; overflow: hidden;
  border: 1px solid rgba(255,255,255,0.08); position: relative;
  animation: popIn 0.4s cubic-bezier(0.34,1.56,0.64,1) both;
  animation-delay: 0.15s;
}
.word-img { width: 100%; height: 190px; object-fit: cover; display: block; }
.img-caption {
  position: absolute; bottom: 0; left: 0; right: 0;
  padding: 20px 14px 8px;
  background: linear-gradient(transparent, rgba(0,0,0,0.7));
  font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.7);
  letter-spacing: 0.06em; text-transform: capitalize;
}
.loading-box { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 20px 0; }
.spinner {
  width: 22px; height: 22px;
  border: 2.5px solid rgba(212,175,55,0.2);
  border-top-color: var(--gold); border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
.loading-text { color: rgba(255,255,255,0.35); font-size: 12px; }

/* Bottom bar */
.bottom-bar {
  flex-shrink: 0;
  padding: 10px 16px 12px;
  display: flex; flex-direction: column; gap: 6px;
}
.nav-row {
  display: flex; align-items: center; justify-content: center; gap: 12px;
}
.nav-arrow {
  display: flex; align-items: center; justify-content: center;
  width: 36px; height: 36px; border-radius: 50%;
  border: 1.5px solid rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.04);
  color: rgba(255,255,255,0.5); cursor: pointer;
  transition: all 0.2s; flex-shrink: 0;
}
.nav-arrow:active { background: rgba(212,175,55,0.15); border-color: var(--gold); color: var(--gold); transform: scale(0.92); }
.nav-arrow svg { width: 18px; height: 18px; }
.slider-area {
  flex: 1; height: 32px; position: relative;
  display: flex; align-items: center;
  touch-action: none; cursor: pointer;
}
.slider-track-bg {
  width: 100%; height: 3px; border-radius: 2px;
  background: rgba(255,255,255,0.08); position: relative; overflow: hidden;
}
.slider-fill {
  height: 100%; border-radius: 2px;
  background: linear-gradient(90deg, var(--gold), rgba(212,175,55,0.5));
  transition: width 0.15s ease;
}
.slider-dots {
  position: absolute; top: 0; left: 0; right: 0; bottom: 0;
  display: flex; align-items: center; justify-content: space-between;
  pointer-events: none; padding: 0 2px;
}
.slider-tick {
  width: 2px; height: 8px; border-radius: 1px;
  background: rgba(255,255,255,0.06); flex-shrink: 0;
}
.slider-tick.major { height: 12px; background: rgba(255,255,255,0.12); }
.slider-tick.active { background: var(--gold); height: 14px; width: 3px; border-radius: 1.5px; box-shadow: 0 0 6px rgba(212,175,55,0.4); }
.slider-thumb {
  position: absolute; top: 50%; transform: translate(-50%, -50%);
  width: 20px; height: 20px; border-radius: 50%;
  background: var(--gold);
  border: 2.5px solid #1a1528;
  box-shadow: 0 0 10px rgba(212,175,55,0.5), 0 2px 6px rgba(0,0,0,0.4);
  cursor: grab; transition: left 0.12s ease;
  z-index: 2;
}
.slider-thumb:active { cursor: grabbing; transform: translate(-50%, -50%) scale(1.15); }
.slider-thumb.dragging { transition: none; transform: translate(-50%, -50%) scale(1.15); }
.slider-counter {
  text-align: center; font-size: 11px; font-weight: 600;
  color: rgba(255,255,255,0.25); letter-spacing: 0.08em;
}

/* Animations */
@keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
@keyframes popIn { 0% { transform: scale(0.92); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
@keyframes letterPop { 0% { transform: scale(0) rotate(-8deg); opacity: 0; } 60% { transform: scale(1.1) rotate(2deg); opacity: 1; } 100% { transform: scale(1) rotate(0); opacity: 1; } }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes slideOutL { from { transform: translateX(0); opacity: 1; } to { transform: translateX(-105%); opacity: 0; } }
@keyframes slideOutR { from { transform: translateX(0); opacity: 1; } to { transform: translateX(105%); opacity: 0; } }
.slide-out-l { animation: slideOutL 0.22s ease forwards; }
.slide-out-r { animation: slideOutR 0.22s ease forwards; }
.fade-in { animation: fadeUp 0.3s ease both; }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <span>üêù</span>
	<h1><a href="index.html" style="color:inherit;text-decoration:none;">Spelling Bee</a></h1>
  </div>
  <button class="mode-btn" id="modeBtn" onclick="toggleMarkedOnly()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
    <span id="modeBtnText">All (6)</span>
  </button>
</div>

<div class="card-area" id="cardArea">
  <div class="card" id="card"></div>
</div>

<div class="bottom-bar">
  <div class="nav-row">
    <button class="nav-arrow" id="prevBtn" onclick="navigateTo('right')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <div class="slider-area" id="sliderArea">
      <div class="slider-track-bg">
        <div class="slider-fill" id="sliderFill"></div>
      </div>
      <div class="slider-dots" id="sliderDots"></div>
      <div class="slider-thumb" id="sliderThumb"></div>
    </div>
    <button class="nav-arrow" id="nextBtn" onclick="navigateTo('left')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 6 15 12 9 18"/></svg>
    </button>
  </div>
  <div class="slider-counter" id="sliderCounter">1 / 208</div>
</div>

<script>
const WORDS = [
  { word:'packet', pronunciation:'PAK-it', ipa:'/Ààp√¶k…™t/', pos:'noun', def:'A small paper or cardboard container holding a quantity of something; a bundle of data transmitted over a network.', lang:'Anglo-French, from paquet (\'a small pack\'), diminutive of Old French pac (\'a bundle\'), of Germanic origin.', example:'She tore open the packet of seeds and scattered them along the freshly turned rows of soil in the garden.', isNoun:true },
  { word:'pageantry', pronunciation:'PAJ-un-tree', ipa:'/Ààp√¶d í…ôntri/', pos:'noun', def:'Elaborate display or ceremony; colorful and spectacular public festivities.', lang:'English, from pageant (from Medieval Latin pagina, \'scene of a play\', from Latin, \'page\') + -ry.', example:'The coronation was filled with pageantry, from the gilded carriages to the trumpeters lining the palace steps.', isNoun:true },
  { word:'paginate', pronunciation:'PAJ-ih-nayt', ipa:'/Ààp√¶d í…™Àåne…™t/', pos:'verb', def:'To assign numbers to the pages of a book, document, or manuscript.', lang:'Latin, from paginare (\'to arrange in pages\'), from pagina (\'a page, leaf\'), + -ate.', example:'The editor asked the assistant to paginate the manuscript before sending it to the printer for the final proof.', isNoun:false },
  { word:'paisley', pronunciation:'PAYZ-lee', ipa:'/Ààpe…™zli/', pos:'noun', def:'A distinctive intricate pattern of curved, feather-shaped figures based on a pine cone design, used especially in textiles.', lang:'Named after Paisley, a town in Scotland that became a major center for producing shawls with this pattern in the 19th century.', example:'His vintage paisley tie added a splash of color and personality to an otherwise plain navy suit.', isNoun:true },
  { word:'palatial', pronunciation:'puh-LAY-shul', ipa:'/p…ôÀàle…™ É…ôl/', pos:'adjective', def:'Resembling a palace in being spacious and splendid; impressively large and luxurious.', lang:'Latin, from palatium (\'palace\', originally the Palatine Hill in Rome where the emperors\' residences stood) + -ial.', example:'The palatial estate featured thirty rooms, manicured gardens, and a swimming pool overlooking the Mediterranean Sea.', isNoun:false },
  { word:'pallor', pronunciation:'PAL-ur', ipa:'/Ààp√¶l…ôr/', pos:'noun', def:'An unhealthy pale appearance; lack of color, especially in the face.', lang:'Latin, from pallor (\'paleness\'), from pallere (\'to be pale\').', example:'The sudden pallor of his face alarmed his colleagues, who immediately insisted he sit down and drink some water.', isNoun:true },
  { word:'panelist', pronunciation:'PAN-ul-ist', ipa:'/Ààp√¶n…ôl…™st/', pos:'noun', def:'A member of a panel taking part in a discussion or advisory group, especially on a broadcast.', lang:'English, from panel (from Old French, \'a piece of cloth, jury list\', from Latin pannus, \'cloth\') + -ist.', example:'Each panelist was given five minutes to present their views before the audience questions began.', isNoun:true },
  { word:'parkour', pronunciation:'par-KOOR', ipa:'/p…ëÀêrÀàk ä…ôr/', pos:'noun', def:'An athletic discipline in which practitioners move rapidly through an area, negotiating obstacles by running, jumping, and climbing.', lang:'French, from parcours (\'course, route\'), from Latin percursus (\'a running through\'), from per- (\'through\') + cursus (\'a running\').', example:'The parkour athlete vaulted over railings and leapt between rooftops with breathtaking speed and precision.', isNoun:true },
  { word:'parley', pronunciation:'PAR-lee', ipa:'/Ààp…ëÀêrli/', pos:'noun', def:'A conference between opposing sides in a dispute, especially regarding a truce; a discussion of terms.', lang:'Old French, from parler (\'to speak\'), from Latin parabolare (\'to talk\'), from parabola (\'a comparison, speech\').', example:'The two generals met under a white flag for a parley, hoping to negotiate an end to the costly siege.', isNoun:true },
  { word:'parlor', pronunciation:'PAR-lur', ipa:'/Ààp…ëÀêrl…ôr/', pos:'noun', def:'A sitting room in a private house; a shop or business providing specified goods or services.', lang:'Old French, from parloir (\'a room for speaking\'), from parler (\'to speak\'), from Latin parabolare.', example:'The old Victorian parlor still had its original velvet furniture, lace curtains, and a grand piano in the corner.', isNoun:true },
  { word:'partridge', pronunciation:'PAR-trij', ipa:'/Ààp…ëÀêrtr…™d í/', pos:'noun', def:'A short-tailed game bird with mainly brown plumage, native to Europe, Asia, and Africa.', lang:'Old French, from perdriz, from Latin perdix, from Greek perdix (\'a partridge\'), of uncertain origin.', example:'A plump partridge burst from the undergrowth with a whirring of wings, startling the hikers on the woodland trail.', isNoun:true },
  { word:'passage', pronunciation:'PAS-ij', ipa:'/Ààp√¶s…™d í/', pos:'noun', def:'A way through or along; a corridor or hallway; a section of a written work or piece of music; a journey by sea or air.', lang:'Old French, from passage (\'a crossing\'), from passer (\'to pass\'), from Latin passus (\'a step, pace\').', example:'The secret passage behind the bookcase led down a narrow stairway to a hidden room beneath the manor house.', isNoun:true },
  { word:'pastime', pronunciation:'PAS-tym', ipa:'/Ààp√¶sÀåta…™m/', pos:'noun', def:'An activity done regularly in one\'s leisure time for enjoyment; a hobby.', lang:'English, from pass + time, translating French passe-temps (\'something that passes the time\').', example:'Baseball has long been called America\'s favorite pastime, bringing families to ballparks every summer for over a century.', isNoun:true },
  { word:'patches', pronunciation:'PACH-iz', ipa:'/Ààp√¶t É…™z/', pos:'noun', def:'Pieces of material used to mend a hole or strengthen a weak point; small areas differing from their surroundings.', lang:'Old French, from pieche (\'a piece\'), possibly of Germanic origin, + -es.', example:'The worn quilt was covered in colorful patches, each one cut from a different piece of fabric with its own story.', isNoun:true },
  { word:'pathogen', pronunciation:'PATH-uh-jen', ipa:'/Ààp√¶Œ∏…ôd í…ôn/', pos:'noun', def:'A bacterium, virus, or other microorganism that can cause disease.', lang:'Greek, from pathos (\'suffering, disease\') + -genes (\'born of, producing\').', example:'The researchers identified the pathogen responsible for the outbreak and began developing a targeted treatment immediately.', isNoun:true },
  { word:'patience', pronunciation:'PAY-shunce', ipa:'/Ààpe…™ É…ôns/', pos:'noun', def:'The capacity to accept or tolerate delay, trouble, or suffering without getting angry or upset.', lang:'Latin, from patientia (\'endurance, submission\'), from patiens (\'suffering\'), present participle of pati (\'to suffer\').', example:'Teaching a toddler to tie their shoes requires extraordinary patience and a willingness to demonstrate the same steps dozens of times.', isNoun:true },
  { word:'pauper', pronunciation:'PAW-pur', ipa:'/Ààp…îÀêp…ôr/', pos:'noun', def:'A very poor person; historically, a person dependent on public charity or welfare.', lang:'Latin, from pauper (\'poor\'), from paucus (\'few\') + parare (\'to produce, get\').', example:'The tale of the prince and the pauper has been told in countless versions, each exploring the contrast between wealth and poverty.', isNoun:true },
  { word:'peat', pronunciation:'PEET', ipa:'/piÀêt/', pos:'noun', def:'A brown, soil-like material consisting of partly decomposed vegetable matter, formed in acidic, waterlogged conditions; used as fuel and in gardening.', lang:'Anglo-Latin, from peta (\'a piece of peat\'), possibly of Celtic origin.', example:'The gardener mixed peat into the soil to improve its moisture retention before planting the blueberry bushes.', isNoun:true },
  { word:'peddle', pronunciation:'PED-ul', ipa:'/Ààp…õd…ôl/', pos:'verb', def:'To sell goods by going from place to place; to promote an idea or view persistently.', lang:'English, back-formation from peddler (from Middle English pedlere, \'a traveling merchant\'), of uncertain origin.', example:'The street vendor peddled roasted chestnuts from a cart on the corner, filling the cold air with their warm, nutty aroma.', isNoun:false },
  { word:'pedigree', pronunciation:'PED-ih-gree', ipa:'/Ààp…õd…™Àå…°riÀê/', pos:'noun', def:'The record of descent of an animal or person; the background or history of someone or something; a lineage or genealogy.', lang:'Old French, from pied de grue (\'crane\'s foot\'), because the branching lines in a genealogical chart resemble a crane\'s footprint.', example:'The dog\'s impressive pedigree traced its lineage back through twelve generations of champion show dogs.', isNoun:true },
  { word:'pending', pronunciation:'PEN-ding', ipa:'/Ààp…õnd…™≈ã/', pos:'adjective', def:'Awaiting decision or settlement; about to happen; not yet decided or completed.', lang:'Latin, from pendere (\'to hang\'), suggesting something left hanging or unresolved.', example:'The court case was still pending, and the anxious defendant had to wait several more weeks for a decision.', isNoun:false },
  { word:'penguin', pronunciation:'PEN-gwin', ipa:'/Ààp…õ≈ã…°w…™n/', pos:'noun', def:'A flightless seabird of the Southern Hemisphere with black and white plumage and wings adapted as flippers for swimming.', lang:'Welsh, possibly from pen (\'head\') + gwyn (\'white\'), originally applied to the now-extinct great auk, later transferred to the Antarctic birds.', example:'The penguin waddled clumsily across the ice, then dove into the water and transformed into an astonishingly graceful swimmer.', isNoun:true },
  { word:'peninsular', pronunciation:'peh-NIN-syoo-lur', ipa:'/p…™Ààn…™nsj äl…ôr/', pos:'adjective', def:'Of, relating to, or situated on a peninsula; resembling a peninsula.', lang:'Latin, from paeninsula (\'a peninsula\'), from paene (\'almost\') + insula (\'island\'), + -ar.', example:'The peninsular region enjoyed mild weather year-round thanks to the moderating influence of the surrounding ocean currents.', isNoun:false },
  { word:'peony', pronunciation:'PEE-uh-nee', ipa:'/ÀàpiÀê…ôni/', pos:'noun', def:'A herbaceous or shrubby plant with large, showy, fragrant flowers in shades of pink, red, white, and yellow.', lang:'Greek, from paionia (\'the healing plant\'), named after Paeon, the physician of the gods in Greek mythology who used it medicinally.', example:'The garden burst into color each May when the peonies bloomed, their enormous pink blossoms heavy with sweet perfume.', isNoun:true },
  { word:'performance', pronunciation:'pur-FOR-munce', ipa:'/p…ôrÀàf…îÀêrm…ôns/', pos:'noun', def:'An act of staging or presenting a work of art; the carrying out of a task or function; how well something works.', lang:'Old French, from parfournir (\'to carry out, complete\'), from par- (\'through\') + fournir (\'to furnish, provide\'), + -ance.', example:'Her performance as Lady Macbeth earned a ten-minute standing ovation and rave reviews in every major newspaper.', isNoun:true },
  { word:'peruse', pronunciation:'puh-ROOZ', ipa:'/p…ôÀàruÀêz/', pos:'verb', def:'To read something carefully and thoroughly; often used more loosely to mean to browse or skim.', lang:'English, from per- (\'thoroughly\') + use (\'to employ\'), originally meaning to use up or go through completely.', example:'She perused the lengthy contract line by line, making notes in the margins before agreeing to sign anything.', isNoun:false },
  { word:'pervasive', pronunciation:'pur-VAY-siv', ipa:'/p…ôrÀàve…™s…™v/', pos:'adjective', def:'Spreading widely throughout an area or group; present and apparent everywhere.', lang:'Latin, from pervasivus, from pervadere (\'to go through\'), from per- (\'through\') + vadere (\'to go\'), + -ive.', example:'The pervasive smell of fresh paint lingered in every room of the newly renovated house for days.', isNoun:false },
  { word:'photogenic', pronunciation:'FOH-tuh-JEN-ik', ipa:'/Àåfo ät…ôÀàd í…õn…™k/', pos:'adjective', def:'Looking attractive in photographs; producing or emitting light.', lang:'Greek, from photos (\'light\') + -genic (\'producing\'), from genes (\'born\').', example:'The photogenic puppy became an internet sensation after its owner posted a single picture that received millions of likes.', isNoun:false },
  { word:'physical', pronunciation:'FIZ-ih-kul', ipa:'/Ààf…™z…™k…ôl/', pos:'adjective', def:'Relating to the body as opposed to the mind; relating to things perceived through the senses; involving bodily contact.', lang:'Latin, from physicalis (\'of nature\'), from physica (\'natural science\'), from Greek physikos (\'of nature\'), from physis (\'nature\').', example:'The physical demands of professional ballet require dancers to maintain peak fitness and flexibility throughout their careers.', isNoun:false },
  { word:'physicists', pronunciation:'FIZ-ih-sists', ipa:'/Ààf…™z…™s…™sts/', pos:'noun', def:'Scientists who study the nature and properties of matter and energy.', lang:'Greek, from physikos (\'natural\'), from physis (\'nature, origin\'), + -ist + -s.', example:'The team of physicists celebrated when their experiment confirmed a prediction that had remained unproven for nearly fifty years.', isNoun:true },
  { word:'pitiful', pronunciation:'PIT-ih-ful', ipa:'/Ààp…™t…™f äl/', pos:'adjective', def:'Deserving or arousing pity; very small or inadequate; contemptible.', lang:'English, from pity (from Old French pite, from Latin pietas, \'piety, compassion\') + -ful.', example:'The pitiful kitten, soaking wet and shivering in the rain, meowed at the doorstep until someone finally let it inside.', isNoun:false },
  { word:'placards', pronunciation:'PLAK-ardz', ipa:'/Ààpl√¶k…ëÀêrdz/', pos:'noun', def:'Signs or notices for public display, either fixed to a wall or carried during a demonstration.', lang:'Old French, from plaquier (\'to lay flat, plaster\'), from Middle Dutch placke (\'a patch, piece\').', example:'The protesters marched through the city center carrying hand-painted placards demanding action on environmental protection.', isNoun:true },
  { word:'placate', pronunciation:'PLAY-kayt', ipa:'/Ààple…™ke…™t/', pos:'verb', def:'To make someone less angry or hostile; to calm or appease.', lang:'Latin, from placatus, past participle of placare (\'to calm, soothe\'), from placere (\'to please\').', example:'The manager offered a sincere apology and a full refund to placate the unhappy customer before the situation escalated.', isNoun:false },
  { word:'platinum', pronunciation:'PLAT-ih-num', ipa:'/Ààpl√¶t…™n…ôm/', pos:'noun', def:'A precious silvery-white metal used in jewelry, catalytic converters, and laboratory equipment; a record that has sold over a million copies.', lang:'Spanish, from platina (\'little silver\'), diminutive of plata (\'silver\'), from Proven√ßal plata (\'a flat piece of metal\').', example:'The singer\'s latest album went platinum within a month of its release, with fans streaming it millions of times.', isNoun:true },
  { word:'pliant', pronunciation:'PLY-unt', ipa:'/Ààpla…™…ônt/', pos:'adjective', def:'Easily bent; flexible; yielding readily to influence or persuasion.', lang:'French, from pliant, present participle of plier (\'to bend, fold\'), from Latin plicare (\'to fold\').', example:'The pliant willow branches swayed gracefully in the wind, bending almost to the ground without snapping.', isNoun:false },
  { word:'plover', pronunciation:'PLUV-ur', ipa:'/Ààpl åv…ôr/', pos:'noun', def:'A short-billed wading bird, typically found by water and known for its distinctive calls.', lang:'Old French, from pluvier (\'rain bird\'), from Latin pluvia (\'rain\'), because the bird was believed to appear before rain.', example:'The small plover darted across the sandy beach, its quick legs a blur as it chased tiny crabs near the waterline.', isNoun:true },
  { word:'plummet', pronunciation:'PLUM-it', ipa:'/Ààpl åm…™t/', pos:'verb', def:'To fall or drop straight down at high speed; to decrease rapidly in value or amount.', lang:'Old French, from plommet (\'a ball of lead\'), diminutive of plomb (\'lead\'), from Latin plumbum (\'lead\').', example:'The temperature plummeted overnight from a mild fifty degrees to a bone-chilling ten below zero.', isNoun:false },
  { word:'poised', pronunciation:'POYZD', ipa:'/p…î…™zd/', pos:'adjective', def:'Having a composed and self-assured manner; balanced and ready for action.', lang:'Old French, from peser (\'to weigh, balance\'), from Latin pensare (\'to weigh carefully\'), from pendere (\'to weigh\').', example:'The gymnast stood poised at the edge of the balance beam, perfectly still for a moment before launching into her routine.', isNoun:false },
  { word:'polarized', pronunciation:'POH-luh-ryzd', ipa:'/Ààpo äl…ôÀåra…™zd/', pos:'adjective', def:'Divided into two sharply contrasting groups or sets of opinions; of light, restricted to vibrating in one direction.', lang:'French, from polariser, from Latin polaris (\'of the pole\'), from polus (\'end of an axis\'), from Greek polos, + -ize + -ed.', example:'The nation became deeply polarized on the issue, with passionate advocates on both sides unwilling to find middle ground.', isNoun:false },
  { word:'policy', pronunciation:'POL-ih-see', ipa:'/Ààp…íl…™si/', pos:'noun', def:'A course of action adopted by a government, organization, or individual; a contract of insurance.', lang:'Old French, from policie (\'civil administration\'), from Latin politia (\'the state\'), from Greek politeia (\'citizenship, government\').', example:'The new company policy allowed employees to work remotely two days a week, boosting morale across every department.', isNoun:true },
  { word:'portal', pronunciation:'POR-tul', ipa:'/Ààp…îÀêrt…ôl/', pos:'noun', def:'A doorway, gate, or entrance, especially a large and imposing one; a website providing access to other sites or services.', lang:'Latin, from portale (\'city gate\'), neuter of portalis (\'of a gate\'), from porta (\'gate\').', example:'The ornate stone portal of the cathedral was carved with figures of saints and angels welcoming visitors inside.', isNoun:true },
  { word:'portrait', pronunciation:'POR-trit', ipa:'/Ààp…îÀêrtr…™t/', pos:'noun', def:'A painting, drawing, photograph, or engraving of a person, especially one depicting only the face or head and shoulders.', lang:'French, from portrait (\'a picture\'), past participle of portraire (\'to portray\'), from Latin protrahere (\'to draw forth\').', example:'The oil portrait of the founder hung in the main hall, her steady gaze watching over the institution she had built.', isNoun:true },
  { word:'portrayal', pronunciation:'por-TRAY-ul', ipa:'/p…îÀêrÀàtre…™…ôl/', pos:'noun', def:'A depiction or description of someone or something in a particular way; an actor\'s representation of a character.', lang:'English, from portray (from Old French portraire, \'to draw forth\', from Latin protrahere) + -al.', example:'Her portrayal of the queen in the historical drama earned her critical acclaim and a nomination for best actress.', isNoun:true },
  { word:'praise', pronunciation:'PRAYZ', ipa:'/pre…™z/', pos:'noun', def:'The expression of approval or admiration for someone or something; the offering of grateful homage to a deity.', lang:'Old French, from preisier (\'to prize, praise\'), from Latin pretiare (\'to value\'), from pretium (\'price, value\').', example:'The teacher\'s praise for the student\'s creative essay boosted her confidence and inspired her to keep writing.', isNoun:true },
  { word:'preacher', pronunciation:'PREE-chur', ipa:'/ÀàpriÀêt É…ôr/', pos:'noun', def:'A person who delivers sermons or religious addresses; someone who advocates a cause or principle.', lang:'Old French, from prechier (\'to preach\'), from Latin praedicare (\'to proclaim publicly\'), from prae- (\'before\') + dicare (\'to declare\'), + -er.', example:'The preacher delivered a powerful sermon that moved the entire congregation to their feet in spontaneous applause.', isNoun:true },
  { word:'preclude', pronunciation:'prih-KLOOD', ipa:'/pr…™ÀàkluÀêd/', pos:'verb', def:'To prevent from happening; to make impossible; to exclude or rule out in advance.', lang:'Latin, from praecludere (\'to close, shut off\'), from prae- (\'before\') + claudere (\'to close, shut\').', example:'The heavy snowfall precluded any possibility of driving to the airport, so they rebooked their flight for the following day.', isNoun:false },
  { word:'predator', pronunciation:'PRED-uh-tur', ipa:'/Ààpr…õd…ôt…ôr/', pos:'noun', def:'An animal that naturally preys on others; a person or group that exploits or victimizes others.', lang:'Latin, from praedator (\'a plunderer\'), from praedari (\'to seize as plunder\'), from praeda (\'prey, booty\').', example:'The lion is the apex predator of the African savanna, feared and respected by every creature that shares its territory.', isNoun:true },
  { word:'predicament', pronunciation:'prih-DIK-uh-munt', ipa:'/pr…™Ààd…™k…ôm…ônt/', pos:'noun', def:'A difficult, unpleasant, or embarrassing situation from which there is no easy escape.', lang:'Latin, from praedicamentum (\'something predicated, a category\'), from praedicare (\'to assert\'), later shifting to mean a difficult situation.', example:'The hikers found themselves in a predicament when the trail washed out and they had no cell signal to call for help.', isNoun:true },
  { word:'premonition', pronunciation:'PREM-uh-NISH-un', ipa:'/Àåpr…õm…ôÀàn…™ É…ôn/', pos:'noun', def:'A strong feeling that something is about to happen, especially something unpleasant; a forewarning or presentiment.', lang:'Latin, from praemonitio (\'a forewarning\'), from praemonere (\'to forewarn\'), from prae- (\'before\') + monere (\'to warn\').', example:'She had an eerie premonition that something was wrong and called home, only to learn that a pipe had burst in the basement.', isNoun:true },
  { word:'previous', pronunciation:'PREE-vee-us', ipa:'/ÀàpriÀêvi…ôs/', pos:'adjective', def:'Existing or occurring before in time or order; prior; coming before something else.', lang:'Latin, from praevius (\'going before\'), from prae- (\'before\') + via (\'way, road\').', example:'Her previous experience as a journalist gave her an edge in the communications role, where strong writing skills were essential.', isNoun:false },
  { word:'primitive', pronunciation:'PRIM-ih-tiv', ipa:'/Ààpr…™m…™t…™v/', pos:'adjective', def:'Relating to or denoting the earliest times in history; very basic or unsophisticated; not developed or derived from anything else.', lang:'Latin, from primitivus (\'first of its kind\'), from primitus (\'at first\'), from primus (\'first\').', example:'The primitive tools discovered at the archaeological site dated back over two million years to the earliest human ancestors.', isNoun:false },
  { word:'primrose', pronunciation:'PRIM-rohz', ipa:'/Ààpr…™mÀåro äz/', pos:'noun', def:'A plant of temperate regions bearing pale yellow flowers in early spring; the soft yellow color of the flower.', lang:'Old French, from primerose, from Medieval Latin prima rosa (\'first rose\'), because it is one of the earliest flowers to bloom in spring.', example:'Clusters of primrose appeared along the woodland path each March, their pale yellow petals signaling the arrival of spring.', isNoun:true },
  { word:'principality', pronunciation:'PRIN-sih-PAL-ih-tee', ipa:'/Àåpr…™ns…™Ààp√¶l…™ti/', pos:'noun', def:'A state ruled by a prince; the territory of a prince; a small sovereign state.', lang:'Latin, from principalitas (\'pre-eminence\'), from principalis (\'first in importance\'), from princeps (\'first, chief\').', example:'The tiny principality of Monaco, nestled along the French Riviera, is famous for its casinos and Formula One race.', isNoun:true },
  { word:'prism', pronunciation:'PRIZ-um', ipa:'/Ààpr…™z…ôm/', pos:'noun', def:'A transparent optical element with flat, polished surfaces that refracts light, separating white light into a spectrum of colors.', lang:'Greek, from prisma (\'something sawed\'), from prizein (\'to saw\'), referring to its geometric shape with parallel faces.', example:'When sunlight passed through the glass prism, it split into a beautiful rainbow of colors across the white wall.', isNoun:true },
  { word:'privy', pronunciation:'PRIV-ee', ipa:'/Ààpr…™vi/', pos:'adjective', def:'Sharing in the knowledge of something secret or private; an outdoor toilet or latrine.', lang:'Old French, from priv√© (\'private, intimate\'), from Latin privatus (\'set apart, personal\'), from privare (\'to deprive, separate\').', example:'Only a handful of executives were privy to the merger plans, which were kept strictly confidential until the announcement.', isNoun:false },
  { word:'procedure', pronunciation:'pruh-SEE-jur', ipa:'/pr…ôÀàsiÀêd í…ôr/', pos:'noun', def:'An established or official way of doing something; a series of actions conducted in a certain order.', lang:'French, from proc√©dure (\'a proceeding\'), from proc√©der (\'to proceed\'), from Latin procedere (\'to go forward\'), from pro- (\'forward\') + cedere (\'to go\').', example:'The surgeon explained the entire procedure to the patient, walking through each step to ease her concerns before the operation.', isNoun:true },
  { word:'procrastinate', pronunciation:'proh-KRAS-tih-nayt', ipa:'/pro äÀàkr√¶st…™Àåne…™t/', pos:'verb', def:'To delay or postpone action; to put off doing something, especially out of habitual laziness or carelessness.', lang:'Latin, from procrastinatus, past participle of procrastinare (\'to put off until tomorrow\'), from pro- (\'forward\') + crastinus (\'of tomorrow\'), from cras (\'tomorrow\').', example:'She promised herself she would stop procrastinating, but then spent another hour scrolling through her phone instead of studying.', isNoun:false },
  { word:'profiteer', pronunciation:'PROF-ih-TEER', ipa:'/Àåpr…íf…™Ààt…™…ôr/', pos:'noun', def:'A person who makes an excessive or unfair profit, especially illegally or during a crisis.', lang:'English, from profit (from Old French, from Latin profectus, \'advance, increase\', from proficere, \'to accomplish\') + -eer.', example:'The wartime profiteer sold basic supplies at outrageous prices, exploiting the desperation of families during the shortage.', isNoun:true },
  { word:'prone', pronunciation:'PROHN', ipa:'/pro än/', pos:'adjective', def:'Likely to suffer from or experience something; lying face downward.', lang:'Latin, from pronus (\'leaning forward, inclined\'), from pro (\'forward\').', example:'The low-lying coastal area was prone to flooding during hurricane season, and residents kept sandbags ready every year.', isNoun:false },
  { word:'proposal', pronunciation:'pruh-POH-zul', ipa:'/pr…ôÀàpo äz…ôl/', pos:'noun', def:'A plan or suggestion put forward for consideration; an offer of marriage.', lang:'English, from propose (from Old French proposer, \'to put forward\', from Latin proponere, \'to set forth\') + -al.', example:'His proposal to build a community garden on the vacant lot received unanimous support from the neighborhood council.', isNoun:true },
  { word:'propulsion', pronunciation:'pruh-PUL-shun', ipa:'/pr…ôÀàp ål É…ôn/', pos:'noun', def:'The action of driving or pushing forward; a force that moves something forward.', lang:'Latin, from propulsio (\'a driving forward\'), from propellere (\'to drive forward\'), from pro- (\'forward\') + pellere (\'to drive\').', example:'The rocket\'s powerful propulsion system generated enough thrust to escape Earth\'s gravitational pull within minutes of launch.', isNoun:true },
  { word:'prosperous', pronunciation:'PROS-pur-us', ipa:'/Ààpr…ísp…ôr…ôs/', pos:'adjective', def:'Successful in material terms; flourishing financially; bringing wealth and success.', lang:'Latin, from prosperus (\'doing well, favorable\'), from pro spe (\'according to hope\'), from pro (\'for\') + spes (\'hope\').', example:'The once-struggling town became prosperous after the tech company built its headquarters there, creating thousands of jobs.', isNoun:false },
  { word:'protein', pronunciation:'PROH-teen', ipa:'/Ààpro ätiÀên/', pos:'noun', def:'A large, complex molecule made up of amino acids, essential for the structure, function, and regulation of the body\'s tissues and organs.', lang:'Greek, from proteios (\'primary, first\'), from protos (\'first\'), because proteins are of primary importance to living things.', example:'Athletes need adequate protein in their diets to repair and build muscle after intense workouts and competitions.', isNoun:true },
  { word:'proxy', pronunciation:'PROK-see', ipa:'/Ààpr…íksi/', pos:'noun', def:'The authority to represent someone else; a person authorized to act on behalf of another; a substitute.', lang:'English, contraction of procuracy (\'the function of a procurator\'), from Latin procuratio (\'a managing\'), from procurare (\'to take care of\').', example:'Since she could not attend the shareholder meeting in person, she appointed her attorney to vote by proxy on her behalf.', isNoun:true },
  { word:'puckish', pronunciation:'PUK-ish', ipa:'/Ààp åk…™ É/', pos:'adjective', def:'Playfully mischievous; impish and full of fun.', lang:'English, from Puck (a mischievous fairy in English folklore, featured in Shakespeare\'s A Midsummer Night\'s Dream) + -ish.', example:'The comedian had a puckish sense of humor, delighting in clever pranks that always left everyone laughing rather than annoyed.', isNoun:false },
  { word:'pulpit', pronunciation:'PUL-pit', ipa:'/Ààp älp…™t/', pos:'noun', def:'A raised enclosed platform in a church from which the preacher delivers a sermon.', lang:'Latin, from pulpitum (\'a platform, stage\'), of uncertain origin.', example:'The minister stepped up to the wooden pulpit and opened the Bible to begin the Sunday morning sermon.', isNoun:true },
  { word:'pummel', pronunciation:'PUM-ul', ipa:'/Ààp åm…ôl/', pos:'verb', def:'To strike repeatedly, typically with the fists; to beat or batter.', lang:'English, variant of pommel (\'to beat with the pommel of a sword\'), from Old French pomel (\'a knob\'), from Latin pomum (\'fruit, apple\').', example:'The boxer pummeled his opponent with a relentless series of body blows that left the referee no choice but to stop the fight.', isNoun:false },
  { word:'punctuation', pronunciation:'PUNK-choo-AY-shun', ipa:'/Àåp å≈ãkt ÉuÀàe…™ É…ôn/', pos:'noun', def:'The marks, such as periods, commas, and parentheses, used in writing to separate sentences and clarify meaning.', lang:'Latin, from punctuatio, from punctuare (\'to mark with points\'), from punctum (\'a point\'), from pungere (\'to prick\').', example:'Correct punctuation can change the entire meaning of a sentence, as any English teacher will eagerly demonstrate.', isNoun:true },
  { word:'punily', pronunciation:'PYOO-nih-lee', ipa:'/ÀàpjuÀên…™li/', pos:'adverb', def:'In a puny or weak manner; feebly or inadequately.', lang:'English, from puny (from Old French puisn√©, \'born later, younger\', from puis, \'afterwards\' + n√©, \'born\') + -ly.', example:'The seedling grew punily in the shadowy corner of the garden, stretching desperately toward the little sunlight it could find.', isNoun:false },
  { word:'puniness', pronunciation:'PYOO-nee-nis', ipa:'/ÀàpjuÀênin…™s/', pos:'noun', def:'The state of being puny; smallness, weakness, or insignificance.', lang:'English, from puny (from Old French puisn√©, \'born later, younger\') + -ness.', example:'Despite the puniness of the sapling compared to the ancient oaks around it, with time it would grow just as tall.', isNoun:true },
  { word:'pupil', pronunciation:'PYOO-pul', ipa:'/ÀàpjuÀêp…ôl/', pos:'noun', def:'A student in school; the dark circular opening in the center of the iris of the eye, which controls the amount of light entering.', lang:'Latin, from pupillus (\'an orphan, ward, minor\'), diminutive of pupus (\'boy\'); the eye sense from pupilla (\'little doll\'), from the tiny image reflected in the eye.', example:'The optometrist shone a light into each pupil to check that they dilated and contracted normally during the examination.', isNoun:true },
  { word:'purification', pronunciation:'PYOOR-ih-fih-KAY-shun', ipa:'/Àåpj ä…ôr…™f…™Ààke…™ É…ôn/', pos:'noun', def:'The removal of contaminants from something; the process of making something pure or clean.', lang:'Latin, from purificatio (\'a cleansing\'), from purificare (\'to make pure\'), from purus (\'pure\') + facere (\'to make\').', example:'The water purification plant treated millions of gallons daily, ensuring safe drinking water for the entire city.', isNoun:true },
  { word:'puritan', pronunciation:'PYOOR-ih-tun', ipa:'/Ààpj ä…ôr…™t…ôn/', pos:'noun', def:'A person with strict moral beliefs who is critical of others\' behavior; historically, a member of the English Protestant group seeking simpler worship.', lang:'Latin, from puritas (\'purity\'), from purus (\'pure\'), + -an; the historical sense refers to the 16th-century English reform movement.', example:'The town\'s founding puritan settlers established strict codes of conduct that governed every aspect of daily life.', isNoun:true },
  { word:'putrid', pronunciation:'PYOO-trid', ipa:'/ÀàpjuÀêtr…™d/', pos:'adjective', def:'Decaying or rotting and emitting a fetid smell; of very poor quality; thoroughly unpleasant.', lang:'Latin, from putridus (\'rotten\'), from putrere (\'to rot\'), from puter (\'rotten\').', example:'The putrid stench from the forgotten leftovers in the back of the refrigerator was enough to make everyone gag.', isNoun:false },
  { word:'pyramid', pronunciation:'PEER-uh-mid', ipa:'/Ààp…™r…ôÀåm…™d/', pos:'noun', def:'A monumental structure with a square or triangular base and sloping sides meeting at a point at the top; an ancient Egyptian royal tomb.', lang:'Greek, from pyramis (genitive pyramidos), possibly from Egyptian pimar (\'pyramid\'), or from pyros (\'wheat\'), from the shape of a wheat cake.', example:'The Great Pyramid of Giza stood for over four thousand years, a testament to the engineering genius of ancient Egypt.', isNoun:true }
];

let currentIndex = 0, flipped = false, markedWords = new Set(), markedOnly = false;
let imageCache = {}, imageLoading = {};
let touchStartX = 0, swipeX = 0;

function aw() { return markedOnly ? WORDS.filter((_,i) => markedWords.has(i)) : WORDS; }
function si() { const a=aw(); if(markedOnly){const i=a.findIndex(w=>w.word===WORDS[currentIndex]?.word);return i>=0?i:0;} return currentIndex; }
function gi() { const a=aw(),s=si(); return WORDS.findIndex(w=>w.word===a[s]?.word); }

function speak(t) { speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance(t); u.rate=0.85;u.pitch=1;u.lang="en-US"; speechSynthesis.speak(u); }

async function fetchImage(word) {
  if(imageCache[word]||imageLoading[word]) return;
  imageLoading[word]=true;
  // Update just the image placeholder if it exists
  const imgPlaceholder = document.getElementById('img-'+word);
  if(imgPlaceholder) imgPlaceholder.innerHTML=`<div class="loading-box"><div class="spinner"></div><span class="loading-text">Finding image‚Ä¶</span></div>`;
  try {
    const r=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1000,messages:[{role:"user",content:'Search online and find a direct image URL for "'+word+'". Return ONLY the raw URL ending in .jpg/.jpeg/.png/.svg/.webp. No markdown, no explanation.'}],tools:[{type:"web_search_20250305",name:"web_search"}]})});
    const d=await r.json(); const t=d.content.map(b=>b.type==="text"?b.text:"").filter(Boolean).join("\n").trim();
    const m=t.match(/https?:\/\/[^\s"'<>\)]+\.(jpg|jpeg|png|svg|webp)([^\s"'<>\)]*)*/i);
    imageCache[word]=m?m[0]:null;
  } catch(e){imageCache[word]=null;}
  imageLoading[word]=false;
  // Update just the image placeholder if still on same word
  const imgEl = document.getElementById('img-'+word);
  if(imgEl && imageCache[word]) {
    imgEl.innerHTML=`<div class="image-box"><img class="word-img" src="${imageCache[word]}" alt="${word}" onerror="this.parentElement.style.display='none'"><div class="img-caption">${word}</div></div>`;
  } else if(imgEl) {
    imgEl.innerHTML='';
  }
}

const starSvg=f=>`<svg viewBox="0 0 24 24" fill="${f?'currentColor':'none'}" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`;
const speakerSvg=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>`;

function renderFront(w) {
  return `
    <div class="sect fade-in"><div class="tag">PRONUNCIATION</div><div class="pron-main">${w.pronunciation}</div><div class="ipa">${w.ipa}</div>
      <button class="listen-btn" onclick="event.stopPropagation();speak('${w.word}')">${speakerSvg}<span>Listen</span></button></div>
    <div class="sect fade-in" style="animation-delay:.06s"><div class="tag">PART OF SPEECH</div><span class="pos-chip">${w.pos}</span></div>
    <div class="sect fade-in" style="animation-delay:.12s"><div class="tag">DEFINITION</div><div class="def-text">${w.def}</div></div>
    <div class="sect fade-in" style="animation-delay:.18s"><div class="tag">LANGUAGE OF ORIGIN</div><div class="origin-text">${w.lang}</div></div>
    <div class="sect fade-in" style="animation-delay:.24s"><div class="tag">EXAMPLE</div><div class="ex-text">"${w.example.replace(new RegExp(w.word,'gi'),'________')}"</div></div>
    <div class="tap-hint fade-in" style="animation-delay:.3s">Tap card to reveal spelling</div>`;
}

function renderBack(w) {
  const letters=w.word.split("").map((c,i)=>`<span class="letter-tile" style="animation-delay:${i*0.04+0.12}s">${c}</span>`).join("");
  let img="";
  if(w.isNoun){
    let imgContent = "";
    if(imageLoading[w.word]) imgContent=`<div class="loading-box"><div class="spinner"></div><span class="loading-text">Finding image‚Ä¶</span></div>`;
    else if(imageCache[w.word]) imgContent=`<div class="image-box"><img class="word-img" src="${imageCache[w.word]}" alt="${w.word}" onerror="this.parentElement.style.display='none'"><div class="img-caption">${w.word}</div></div>`;
    img=`<div id="img-${w.word}">${imgContent}</div>`;
  }
  return `<div class="back-content">
    <div class="spelling-box" style="animation:popIn .4s cubic-bezier(.34,1.56,.64,1) both">
      <div class="spelling-label">THE WORD IS</div><h2 class="spelling-word">${w.word}</h2>
      <div class="letters-row">${letters}</div>
      <button class="listen-btn" style="margin:14px auto 0" onclick="event.stopPropagation();speak('${w.word}')">${speakerSvg}<span>Hear Again</span></button>
    </div>${img}
    <div class="tap-hint">Tap card to go back to clues</div></div>`;
}

function render() {
  const a=aw();
  if(!a.length){ document.getElementById("card").innerHTML=`<div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px"><p style="color:rgba(255,255,255,0.5);font-size:16px">No marked words yet.</p><button class="flip-btn" style="width:auto;padding:10px 24px" onclick="markedOnly=false;render()">‚Üê Show All</button></div>`; return; }
  const s=si(), g=gi(), w=a[s];

  document.getElementById("card").innerHTML=`<div class="card-top"><span class="counter">${s+1} / ${a.length}</span><div class="card-top-right"><span class="side-label">${flipped?'ANSWER':'CLUES'}</span><button class="mark-btn ${markedWords.has(g)?'active':''}" onclick="toggleMark(${g})">${starSvg(markedWords.has(g))}</button></div></div>`+(flipped?renderBack(w):renderFront(w));

  if(flipped && w.isNoun&&!imageCache[w.word]&&!imageLoading[w.word]) fetchImage(w.word);

  // Slider
  const totalA = a.length;
  const pct = totalA > 1 ? s / (totalA - 1) * 100 : 0;
  document.getElementById("sliderFill").style.width = pct + "%";
  const sliderArea = document.getElementById("sliderArea");
  const areaW = sliderArea.offsetWidth || 200;
  const pad = 10;
  const thumbLeft = pad + (pct / 100) * (areaW - pad * 2);
  const thumb = document.getElementById("sliderThumb");
  if(!thumb.classList.contains('dragging')) thumb.style.left = thumbLeft + "px";

  // Ticks - show ~20 evenly spaced markers
  const tickCount = Math.min(totalA, 20);
  let ticksHtml = '';
  for(let t=0; t<tickCount; t++){
    const ti = Math.round(t / (tickCount-1) * (totalA-1));
    const cls = ti===s ? 'active' : (t % 5 === 0 ? 'major' : '');
    ticksHtml += `<div class="slider-tick ${cls}"></div>`;
  }
  document.getElementById("sliderDots").innerHTML = ticksHtml;
  document.getElementById("sliderCounter").textContent = `${s+1} / ${totalA}`;

  // Mode btn
  const mb=document.getElementById("modeBtn");
  mb.className="mode-btn"+(markedOnly?" active":"");
  mb.querySelector("svg").setAttribute("fill",markedOnly?"currentColor":"none");
  document.getElementById("modeBtnText").textContent=(markedOnly?"Marked":"All")+` (${markedOnly?markedWords.size:WORDS.length})`;
}

function jumpTo(idx) {
  const a=aw(); if(idx<0||idx>=a.length) return;
  const g=WORDS.findIndex(w=>w.word===a[idx].word);
  flipped=false; currentIndex=g; render();
  setTimeout(()=>speak(a[idx].word),200);
}

function navigateTo(dir) {
  const a=aw(); if(!a.length) return;
  const s=si(), card=document.getElementById("card");
  card.classList.add(dir==="left"?"slide-out-l":"slide-out-r");
  flipped=false;
  setTimeout(()=>{
    card.classList.remove("slide-out-l","slide-out-r");
    const ni=dir==="left"?(s+1)%a.length:(s-1+a.length)%a.length;
    currentIndex=WORDS.findIndex(w=>w.word===a[ni].word);
    render(); setTimeout(()=>speak(a[ni].word),150);
  },220);
}

function flipCard(){flipped=!flipped;render();}
function toggleMark(g){markedWords.has(g)?markedWords.delete(g):markedWords.add(g);render();}
function toggleMarkedOnly(){if(!markedOnly&&markedWords.size===0)return;markedOnly=!markedOnly;flipped=false;render();}

// Swipe
const ca=document.getElementById("cardArea");
let swiped=false;
ca.addEventListener("touchstart",e=>{touchStartX=e.touches[0].clientX;swiped=false;},{passive:true});
ca.addEventListener("touchmove",e=>{swipeX=e.touches[0].clientX-touchStartX;if(Math.abs(swipeX)>15)swiped=true;},{passive:true});
ca.addEventListener("touchend",()=>{if(Math.abs(swipeX)>50)navigateTo(swipeX<0?"left":"right");swipeX=0;});

// Card tap to flip
const card=document.getElementById("card");
card.addEventListener("click",e=>{
  if(e.target.closest('button')||swiped) return;
  flipCard();
});

// Slider drag
const slArea=document.getElementById("sliderArea");
const slThumb=document.getElementById("sliderThumb");
let slDragging=false;
function sliderFromX(cx){
  const r=slArea.getBoundingClientRect();
  const pad=10;
  const p=Math.max(0,Math.min(1,(cx-r.left-pad)/(r.width-pad*2)));
  const a=aw(),idx=Math.round(p*(a.length-1));
  // Move thumb immediately for smooth feel
  const thumbLeft=pad+(p)*(r.width-pad*2);
  slThumb.style.left=thumbLeft+"px";
  if(idx!==si()){
    const g=WORDS.findIndex(w=>w.word===a[idx].word);
    flipped=false; currentIndex=g; render();
  }
}
slArea.addEventListener("touchstart",e=>{
  slDragging=true; slThumb.classList.add('dragging');
  sliderFromX(e.touches[0].clientX);
},{passive:true});
document.addEventListener("touchmove",e=>{
  if(slDragging) sliderFromX(e.touches[0].clientX);
},{passive:true});
document.addEventListener("touchend",()=>{
  if(slDragging){
    slDragging=false; slThumb.classList.remove('dragging');
    // Speak the word after releasing
    const a=aw(),s=si();
    if(a[s]) setTimeout(()=>speak(a[s].word),100);
  }
});
slArea.addEventListener("mousedown",e=>{
  slDragging=true; slThumb.classList.add('dragging');
  sliderFromX(e.clientX); e.preventDefault();
});
document.addEventListener("mousemove",e=>{
  if(slDragging) sliderFromX(e.clientX);
});
document.addEventListener("mouseup",()=>{
  if(slDragging){
    slDragging=false; slThumb.classList.remove('dragging');
    const a=aw(),s=si();
    if(a[s]) setTimeout(()=>speak(a[s].word),100);
  }
});

// Keyboard
document.addEventListener("keydown",e=>{
  if(e.key==="ArrowRight")navigateTo("left");
  else if(e.key==="ArrowLeft")navigateTo("right");
  else if(e.key===" "){e.preventDefault();flipCard();}
});

render();
setTimeout(()=>speak(WORDS[0].word),500);
</script>
</body>
</html>
